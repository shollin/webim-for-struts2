(function(y,D,ja){function xa(e){return ya.call(e)==="[object Function]"}function za(e){return ya.call(e)==="[object Array]"}function Ca(e){return e&&ya.call(e)==="[object Object]"}function Aa(e){return(e||"").replace(/^\s+|\s+$/g,"")}function pa(e,g){var j=false;if(Ca(g)){e=e||{};for(var l in g){var q=g[l];if(e[l]!=q){j=j||{};j[l]=q}}}return j}function la(e){var g=[];if(e!=null){var j=e.length;if(j==null||typeof e==="string"||xa(e)||e.setInterval)g[0]=e;else for(;j;)g[--j]=e[j]}return g}function K(){var e=
arguments[0]||{},g=1,j=arguments.length,l=false,q;if(typeof e==="boolean"){l=e;e=arguments[1]||{};g=2}if(typeof e!=="object"&&!xa(e))e={};for(;g<j;g++)if((q=arguments[g])!=null)for(var r in q){var p=e[r],v=q[r];if(e!==v)if(l&&v&&typeof v==="object"&&!v.nodeType)e[r]=K(l,p||(v.length!=null?[]:{}),v);else if(v!==ja)e[r]=v}return e}function O(e,g,j){var l,q=0,r=e.length,p=r===ja||xa(e);if(j)if(p)for(l in e){if(g.apply(e[l],j)===false)break}else for(;q<r;){if(g.apply(e[q++],j)===false)break}else if(p)for(l in e){if(g.call(e[l],
l,e[l])===false)break}else for(j=e[0];q<r&&g.call(j,q,j)!==false;j=e[++q]);return e}function fa(e,g,j){for(var l=[],q=0,r=e.length;q<r;q++)!j!==!g(e[q],q)&&l.push(e[q]);return l}function qa(e,g){for(var j=[],l,q=0,r=e.length;q<r;q++){l=g(e[q],q);if(l!=null)j[j.length]=l}return j.concat.apply([],j)}function ga(e){this.type=e;this.timeStamp=(new Date).getTime()}function M(e){this.URL=e;this._setting();this._connect()}function B(e,g){var j=this;g=g||{};var l=j.ws=new WebSocket(e);l.onopen=function(){j.trigger("open",
"success");l.send("subscribe "+g.domain+" "+g.ticket)};l.onclose=function(q){j.trigger("close",[q.data])};l.onmessage=function(q){q=q.data;try{q=q?y.JSON&&y.JSON.parse?y.JSON.parse(q):(new Function("return "+q))():q}catch(r){}j.trigger("message",[q])};l.onerror=function(){j.trigger("error",[])}}function ra(e,g,j){if(typeof g!="undefined"){j=j||{};if(g===null){g="";j.expires=-1}var l="";if(j.expires&&(typeof j.expires=="number"||j.expires.toUTCString)){if(typeof j.expires=="number"){l=new Date;l.setTime(l.getTime()+
j.expires*24*60*60*1E3)}else l=j.expires;l="; expires="+l.toUTCString()}var q=j.path?"; path="+j.path:"",r=j.domain?"; domain="+j.domain:"";j=j.secure?"; secure":"";D.cookie=[e,"=",encodeURIComponent(g),l,q,r,j].join("")}else{g=null;if(D.cookie&&D.cookie!=""){j=D.cookie.split(";");for(l=0;l<j.length;l++){q=Aa(j[l]);if(q.substring(0,e.length+1)==e+"="){g=decodeURIComponent(q.substring(e.length+1));break}}}return g}}function J(e,g){this.options=K({},J.defaults,g);this._init(e,g)}function x(e){return e&&
e.split?e.split(","):za(e)?e:parseInt(e)?[parseInt(e)]:[]}function ka(e,g,j){function l(q,r){this.data=q;this.options=K({},l.defaults,r);xa(this._init)&&this._init()}l.defaults=g;ga.on(l);K(l.prototype,j);J[e]=l}function G(e,g){if(typeof e=="string"){e[e]=g;if(g===ja)return G[e]}K(G,e)}var ya=Object.prototype.toString;ga.on=function(){for(var e,g=ga.on.prototype,j=0,l=arguments.length;j<l;j++){e=arguments[j].prototype;e.bind=e.addEventListener=g.addEventListener;e.unbind=e.removeEventListener=g.removeEventListener;
e.trigger=e.dispatchEvent=g.dispatchEvent}};ga.on.prototype={addEventListener:function(e,g){var j=this.__listeners=this.__listeners||{};j[e]=j[e]||[];j[e].push(g);return this},dispatchEvent:function(e,g){var j=this.__listeners=this.__listeners||{};e=e.type?e:new ga(e);j=j[e.type];if(Object.prototype.toString.call(g)==="[object Array]")g.unshift(e);else g=[e,g];if(j)for(var l=0,q=j.length;l<q;l++)j[l].apply(this,g);return this},removeEventListener:function(e,g){var j=this.__listeners=this.__listeners||
{};if(j[e])if(g){j=j[e];for(var l=j.length;l--;)j[l]===g&&j.splice(l,1)}else delete j[e];return this}};var T=function(){function e(u){var n={};for(var E in e.settings)n[E]=e.settings[E];if(u)for(E in u)n[E]=u[E];if(n.dataType==="jsonp")n.type="GET";var R,S,L,C=n.type.toUpperCase(),ha=q.test(C),ia,W,Da=y,X;n.url=n.url.replace(da,"");n.context=u&&u.context!=null?u.context:n;if(n.data&&n.processData&&typeof n.data!=="string")n.data=g(n.data,n.traditional);var aa=H.exec(n.url);E=y.location;aa=aa&&(aa[1]&&
aa[1]!==E.protocol||aa[2]!==E.host);/https?:/i.test(E.protocol)||(aa=false);aa=n.forceRemote?true:aa;if(n.dataType==="jsonp"&&!aa)n.dataType="json";if(n.dataType==="jsonp"){if(C==="GET")p.test(n.url)||(n.url+=(v.test(n.url)?"&":"?")+(n.jsonp||"callback")+"=?");else if(!n.data||!p.test(n.data))n.data=(n.data?n.data+"&":"")+(n.jsonp||"callback")+"=?";n.dataType="json"}if(n.dataType==="json"&&(n.data&&p.test(n.data)||p.test(n.url))){R=n.jsonpCallback||"jsonp"+j++;if(n.data)n.data=(n.data+"").replace(p,
"="+R+"$1");n.url=n.url.replace(p,"="+R+"$1");n.dataType="script";var Ba=y[R],sa=false;y[R]=function(ea){if(!sa){sa=true;if(Object.prototype.toString.call(Ba)==="[object Function]")Ba(ea);else{y[R]=ja;try{delete y[R]}catch(a){}}L=ea;N.handleSuccess(n,I,S,L);N.handleComplete(n,I,S,L);ia&&ia.removeChild(X);W&&W.parentNode&&W.parentNode.removeChild(W)}}}if(n.dataType==="script"&&n.cache===null)n.cache=false;if(n.cache===false&&C==="GET"){var Ea=(new Date).getTime(),ta=n.url.replace(F,"$1_="+Ea);n.url=
ta+(ta===n.url?(v.test(n.url)?"&":"?")+"_="+Ea:"")}if(n.data&&C==="GET")n.url+=(v.test(n.url)?"&":"?")+n.data;n.global&&N.active++;if(n.dataType==="script"&&C==="GET"&&aa){u=false;if(R&&n.async&&!l)if(y._fragmentProxy)ia=W=D.createDocumentFragment();else{u=true;if(n.url.slice(0,1)=="/")n.url=E.protocol+"//"+E.host+(E.port?":"+E.port:"")+n.url;else if(!/^https?:\/\//i.test(n.url)){E=E.href;C=/([^?#]+)\//.exec(E);n.url=(C?C[1]:E)+"/"+n.url}n.url=n.url.replace("="+R,"=parent."+R);W=D.createElement("iframe");
W.style.position="absolute";W.style.left="-100px";W.style.top="-100px";W.style.height="1px";W.style.width="1px";W.style.visibility="hidden";D.body.insertBefore(W,D.body.firstChild);Da=W.contentWindow}var Fa=function(){var ea;try{ea=Da.document}catch(a){ea=y.document}ia=ia||ea.getElementsByTagName("head")[0]||ea.documentElement;X=ea.createElement("script");if(n.scriptCharset)X.charset=n.scriptCharset;X.src=n.url;if(l)X.async=n.async;if(R)X.onload=X.onerror=X.onreadystatechange=function(){if(!sa&&(!this.readyState||
this.readyState==="loaded"||this.readyState==="complete")){sa=true;N.handleError(n,I,"error","load error");ia&&X.parentNode&&ia.removeChild(X);W&&W.parentNode&&W.parentNode.removeChild(W)}};else{var b=false;X.onload=X.onreadystatechange=function(){if(!b&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){b=true;N.handleSuccess(n,I,S,L);N.handleComplete(n,I,S,L);X.onload=X.onreadystatechange=null;ia&&X.parentNode&&ia.removeChild(X)}}}ia.insertBefore(X,ia.firstChild)};u?setTimeout(function(){Fa()},
0):Fa();return ja}var va=false,I=n.xhr();if(I){n.username?I.open(C,n.url,n.async,n.username,n.password):I.open(C,n.url,n.async);try{if(n.data!=null&&!ha||u&&u.contentType)I.setRequestHeader("Content-Type",n.contentType);if(n.ifModified){N.lastModified[n.url]&&I.setRequestHeader("If-Modified-Since",N.lastModified[n.url]);N.etag[n.url]&&I.setRequestHeader("If-None-Match",N.etag[n.url])}aa||I.setRequestHeader("X-Requested-With","XMLHttpRequest");I.setRequestHeader("Accept",n.dataType&&n.accepts[n.dataType]?
n.accepts[n.dataType]+", */*; q=0.01":n.accepts._default)}catch(wa){}if(n.beforeSend&&n.beforeSend.call(n.context,I,n)===false){n.global&&N.active--;I.abort();return false}n.global&&N.triggerGlobal(n,"ajaxSend",[I,n]);var U=I.onreadystatechange=function(ea){if(!I||I.readyState===0||ea==="abort"){va||N.handleComplete(n,I,S,L);va=true;if(I)I.onreadystatechange=N.noop}else if(!va&&I&&(I.readyState===4||ea==="timeout")){va=true;I.onreadystatechange=N.noop;S=ea==="timeout"?"timeout":!N.httpSuccess(I)?
"error":n.ifModified&&N.httpNotModified(I,n.url)?"notmodified":"success";var a;if(S==="success")try{L=N.httpData(I,n.dataType,n)}catch(b){S="parsererror";a=b}if(S==="success"||S==="notmodified")R||N.handleSuccess(n,I,S,L);else N.handleError(n,I,S,a);R||N.handleComplete(n,I,S,L);ea==="timeout"&&I.abort();if(n.async)I=null}};try{var ba=I.abort;I.abort=function(){I&&ba.call&&ba.call(I);U("abort")}}catch(Ha){}n.async&&n.timeout>0&&setTimeout(function(){I&&!va&&U("timeout")},n.timeout);try{I.send(ha||
n.data==null?null:n.data)}catch(Ga){N.handleError(n,I,null,Ga);N.handleComplete(n,I,S,L)}n.async||U();return I}}function g(u){var n=[];if(typeof u=="object"){for(var E in u)n[n.length]=encodeURIComponent(E)+"="+encodeURIComponent(u[E]);return n.join("&").replace(P,"+")}return u}var j=(new Date).getTime(),l=typeof D.createElement("script").async==="boolean",q=/^(?:GET|HEAD|DELETE)$/,r=/\S/,p=/\=\?(&|$)/,v=/\?/,F=/([?&])_=[^&]*/,H=/^(\w+:)?\/\/([^\/?#]+)/,P=/%20/g,da=/#.*$/;y._fragmentProxy=false;var ma=
D.createDocumentFragment(),Y=D.createElement("script");try{Y.appendChild(D.createTextNode("window._fragmentProxy = true"))}catch(ua){Y.text="window._fragmentProxy = true"}ma.appendChild(Y);ma=Y=null;e.param=g;var N={noop:function(){},active:0,lastModified:{},etag:{},handleError:function(u,n,E,R){u.error&&u.error.call(u.context,n,E,R);u.global&&N.triggerGlobal(u,"ajaxError",[n,u,R])},handleSuccess:function(u,n,E,R){u.success&&u.success.call(u.context,R,E,n);u.global&&N.triggerGlobal(u,"ajaxSuccess",
[n,u])},handleComplete:function(u,n,E){u.complete&&u.complete.call(u.context,n,E);u.global&&N.triggerGlobal(u,"ajaxComplete",[n,u]);u.global&&N.active--},triggerGlobal:function(){},httpSuccess:function(u){try{return!u.status&&location.protocol==="file:"||u.status>=200&&u.status<300||u.status===304||u.status===1223}catch(n){}return false},httpNotModified:function(u,n){var E=u.getResponseHeader("Last-Modified"),R=u.getResponseHeader("Etag");if(E)N.lastModified[n]=E;if(R)N.etag[n]=R;return u.status===
304},httpData:function(u,n,E){var R=u.getResponseHeader("content-type")||"",S=n==="xml"||!n&&R.indexOf("xml")>=0;u=S?u.responseXML:u.responseText;S&&u.documentElement.nodeName==="parsererror"&&N.error("parsererror");if(E&&E.dataFilter)u=E.dataFilter(u,n);if(typeof u==="string")if(n==="json"||!n&&R.indexOf("json")>=0)u=u?y.JSON&&y.JSON.parse?y.JSON.parse(u):(new Function("return "+u))():u;else if(n==="script"||!n&&R.indexOf("javascript")>=0)if(u&&r.test(u)){n=D.getElementsByTagName("head")[0]||D.documentElement;
E=D.createElement("script");E.type="text/javascript";try{E.appendChild(D.createTextNode(u))}catch(L){E.text=u}n.insertBefore(E,n.firstChild);n.removeChild(E)}return u}};e.settings={url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:function(){return new y.XMLHttpRequest},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",
_default:"*/*"}};e.setup=function(u){if(u)for(var n in u)e.settings[n]=u[n]};if(y.ActiveXObject)e.settings.xhr=function(){if(y.location.protocol!=="file:")try{return new y.XMLHttpRequest}catch(u){}try{return new y.ActiveXObject("Microsoft.XMLHTTP")}catch(n){}};return e}(),na=y.JSON?y.JSON:function(){function e(l){return j[l]||"\\u00"+Math.floor(l.charCodeAt()/16).toString(16)+(l.charCodeAt()%16).toString(16)}function g(l){switch(Object.prototype.toString.call(l)){case "[object String]":return'"'+
l.replace(/[\x00-\x1f\\"]/g,e)+'"';case "[object Array]":for(var q=[],r=l.length,p=0;p<r;p++)q.push(g(l[p]));return"["+q.join(",")+"]";case "[object Object]":q=[];for(r in l)(p=g(l[r]))&&q.push(g(r)+":"+p);return"{"+q+"}";case "[object Number]":case "[object Boolean]":return String(l);case false:return"null"}return null}var j={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{stringify:g,parse:function(l){l=l.toString();if(!l||!l.length)return null;return(new Function("return "+
l))()}}}();M.prototype={readyState:0,send:function(){},_setting:function(){this.readyState=M.CLOSED;this._onPolling=this._connecting=false;this._pollTimer=null;this._failTimes=this._pollingTimes=0},_connect:function(){var e=this;if(e._connecting)return e;e.readyState=M.CONNECTING;e._connecting=true;e._onPolling||y.setTimeout(function(){e._startPolling()},300);return e},close:function(){this._pollTimer&&clearTimeout(this._pollTimer);this._setting();return this},_onConnect:function(){this.readyState=
M.OPEN;this.trigger("open","success")},_onClose:function(e){var g=this;g._setting();setTimeout(function(){g.trigger("close",[e])},1E3)},_onData:function(e){this.trigger("message",[e])},_onError:function(e){var g=this;g._setting();setTimeout(function(){g.trigger("error",[e])},1E3)},_startPolling:function(){if(this._connecting){this._onPolling=true;this._pollingTimes++;T({url:this.URL,dataType:"jsonp",cache:false,context:this,success:this._onPollSuccess,error:this._onPollError})}},_onPollSuccess:function(e){var g=
this;g._onPolling=false;if(g._connecting)if(e){g._pollingTimes==1&&g._onConnect();g._onData(e);g._failTimes=0;g._pollTimer=y.setTimeout(function(){g._startPolling()},200)}else return g._onError("error data")},_onPollError:function(e){var g=this;g._onPolling=false;if(g._connecting){g._failTimes++;if(g._pollingTimes==1)g._onError("can not connect.");else if(g._failTimes>1)g._onClose(e);else g._pollTimer=y.setTimeout(function(){g._startPolling()},200)}}};M.CONNECTING=0;M.OPEN=1;M.CLOSED=2;ga.on(M);B.prototype=
{readyState:0,send:function(){},close:function(){this.ws.close()}};B.enable=!!y.WebSocket;B.CONNECTING=0;B.OPEN=1;B.CLOSED=2;ga.on(B);ga.on(J);J.csrf_token="";J.OFFLINE=0;J.BEFOREONLINE=1;J.ONLINE=2;K(J.prototype,{state:J.OFFLINE,_init:function(){var e=this.options;this.data={user:{presence:"offline",show:"unavailable"}};this.models={};T.settings.dataType=e.jsonp?"jsonp":"json";this.status=new J.status;this.setting=new J.setting;this.models.presence=new J.presence;this.buddy=new J.buddy;this.room=
new J.room(null,this.data);this.history=new J.history(null,this.data);this._initEvents()},_createConnect:function(){var e=this,g=e.data.connection;e.connection=e.options.connectionType!="jsonpd"&&g.websocket&&B.enable?new B(g.websocket,g):new M(g.server+(/\?/.test(g)?"&":"?")+T.param({ticket:g.ticket,domain:g.domain}));e.connection.bind("connect",function(){}).bind("message",function(j,l){e.handle(l)}).bind("error",function(){e._stop("connect","Connect Error")}).bind("close",function(){e._stop("connect",
"Disconnect")})},setUser:function(e){K(this.data.user,e)},_ready:function(e){this.state=J.BEFOREONLINE;this.trigger("beforeOnline",[e])},_go:function(){var e=this.data,g=this.history,j=this.buddy,l=this.room,q=this.models.presence;this.state=J.ONLINE;g.options.userInfo=e.user;O(e.buddies,function(r,p){g.init("chat",p.id,p.history)});j.set(e.buddies);e.presences?q.set(e.presences):q.set(qa(e.buddies,function(r){var p={};p[r.id]=r.show;return p}));O(e.rooms,function(r,p){g.init("grpchat",p.id,p.history)});
l.set(e.rooms);l.options.ticket=e.connection.ticket;this.trigger("online",[e]);this._createConnect();j=[];if(e.new_messages)j=j.concat(e.new_messages);if(e.offline_messages)j=j.concat(e.offline_messages);if(j&&j.length){O(j,function(r,p){p["new"]=true});this.trigger("message",[j])}},_stop:function(e,g){if(this.state!==J.OFFLINE){this.state=J.OFFLINE;this.data.user.presence="offline";this.data.user.show="unavailable";this.buddy.clear();this.models.presence.clear();this.room.clear();this.history.clean();
this.trigger("offline",[e,g])}},autoOnline:function(){return!this.status.get("o")},_initEvents:function(){function e(F){var H={id:F.from,presence:F.type};if(F.show)H.show=F.show;if(F.nick)H.nick=F.nick;if(F.status)H.status=F.status;return H}function g(F){return F.type=="online"||F.type=="offline"||F.type=="show"}function j(F){return F.type=="grponline"||F.type=="grpoffline"||F.type=="invite"||F.type=="join"||F.type=="leave"}var l=this,q=l.history,r=l.buddy,p=l.models.presence,v=l.room;l.bind("message",
function(F,H){for(var P=[],da=H.length,ma=l.data.user.id,Y,ua,N,u=0;u<da;u++){Y=H[u];N=Y.type;ua=N=="chat"?Y.to==ma?Y.from:Y.to:Y.to;Y.id=ua;if(N=="chat"&&!Y["new"]){ua={id:ua,presence:"online"};if(Y.nick&&Y.to==ma)ua.nick=Y.nick;P.push(ua)}}if(P.length){r.presence(P);r.complete()}q.set(H)});l.bind("presence",function(F,H){var P=fa(H,g);r.presence(qa(P,e));p.update(P);H=fa(H,j);for(P=H.length-1;P>=0;P--)v.onPresence(H[P])})},handle:function(e){if(e.messages&&e.messages.length){for(var g=e.messages,
j=[],l=[],q=0;q<g.length;q++){var r=g[q];if(r.body&&r.body.indexOf("webim-event:")==0){r.event=r.body.replace("webim-event:","").split("|,|");l.push(r)}else j.push(r)}j.length&&this.trigger("message",[j]);l.length&&this.trigger("event",[l])}e.presences&&e.presences.length&&this.trigger("presence",[e.presences]);e.statuses&&e.statuses.length&&this.trigger("status",[e.statuses])},sendMessage:function(e,g){e.ticket=this.data.connection.ticket;this.trigger("sendMessage",[e]);T({type:"post",cache:false,
url:G("message"),data:K({csrf_token:J.csrf_token},e),success:g,error:g})},sendStatus:function(e,g){e.ticket=this.data.connection.ticket;this.trigger("sendStatus",[e]);T({type:"post",cache:false,url:G("status"),data:K({csrf_token:J.csrf_token},e),success:g,error:g})},sendPresence:function(e,g){e.ticket=this.data.connection.ticket;this.data.user.show=e.show;this.status.set("s",e.show);this.trigger("sendPresence",[e]);T({type:"post",cache:false,url:G("presence"),data:K({csrf_token:J.csrf_token},e),success:g,
error:g})},online:function(e){var g=this,j=g.status;if(g.state===J.OFFLINE){var l=[],q=[],r=j.get("tabs"),p=j.get("tabIds");p&&p.length&&r&&O(r,function(v){v[0]=="b"&&l.push(v.slice(2));v[0]=="r"&&q.push(v.slice(2))});e=K({buddy_ids:l.join(","),room_ids:q.join(","),csrf_token:J.csrf_token,show:j.get("s")||"available"},e);g._ready(e);j.set("o",false);j.set("s",e.show);T({type:"post",cache:false,url:G("online"),data:e,success:function(v){if(v)if(v.success){v.user=K(g.data.user,v.user,{presence:"online"});
g.data=v;g._go()}else g._stop("online",v.error_msg);else g._stop("online","Not Found")},error:function(){g._stop("online","Not Found")}})}},offline:function(){var e=this.data;if(this.state!==J.OFFLINE){this.status.set("o",true);this.connection.close();this._stop("offline","offline");T({type:"post",cache:false,url:G("offline"),data:{status:"offline",csrf_token:J.csrf_token,ticket:e.connection.ticket}})}},_deactivate:function(){var e=this.data;!e||!e.connection||!e.connection.ticket||T({type:"get",
cache:false,url:G("deactivate"),data:{ticket:e.connection.ticket,csrf_token:J.csrf_token}})}});y.webim=J;K(J,{version:"5.5",defaults:{},log:function(){var e=new Date;["[",e.getHours(),":",e.getMinutes(),":",e.getSeconds(),"-",e.getMilliseconds(),"]"].join("");if(y&&y.console)y.console.log.apply(null,arguments);else y&&y.runtime&&y.air&&y.air.Introspector&&y.air.Introspector.Console.log.apply(null,arguments)},idsArray:x,now:function(){return(new Date).getTime()},isFunction:xa,isArray:za,isObject:Ca,
trim:Aa,makeArray:la,extend:K,each:O,inArray:function(e,g){for(var j=0,l=g.length;j<l;j++)if(g[j]===e)return j;return-1},grep:fa,map:qa,JSON:na,ajax:T,comet:M,socket:B,model:ka,route:G,ClassEvent:ga});ka("setting",{data:{play_sound:true,buddy_sticky:true,minimize_layout:true,msg_auto_pop:true}},{_init:function(){this.data=K({},this.options.data,this.data)},get:function(e){return this.data[e]},set:function(e,g){var j=this,l=e;if(e){if(typeof e=="string"){l={};l[e]=g}var q=j.data,r=pa(q,l);if(r){O(r,
function(p,v){j.trigger("update",[p,v])});l=K({},q,l);j.data=l;T({type:"post",url:G("setting"),cache:false,data:{data:na.stringify(l),csrf_token:J.csrf_token}})}}}});ka("status",{key:"_webim"},{_init:function(){var e=this.data,g=this.options.key,j=y.localStorage;if(j)try{j.setItem("__store_webim__","__store_webim__");if(j.getItem("__store_webim__")=="__store_webim__")this.store=j;j.removeItem("__store_webim__")}catch(l){this.store=ja}if(e)this._save(e);else this.data=(e=this.store?this.store.getItem(g):
ra(g))?na.parse(e):{}},set:function(e,g){var j=e;if(typeof e=="string"){j={};j[e]=g}var l=this.data;pa(l,j)&&this._save(K({},l,j))},get:function(e){return this.data[e]},clear:function(){this._save({})},_save:function(e){var g=this.options.key;this.data=e;e=na.stringify(e);this.store?this.store.setItem(g,e):ra(g,e,{path:"/",domain:D.domain})}});ka("buddy",{active:true},{_init:function(){this.data=this.data||[];this.dataHash={};this.set(this.data)},remove:function(e){var g=this.get(e);if(g){T({type:"post",
url:G("remove_buddy"),cache:false,data:{id:e,csrf_token:J.csrf_token},success:function(){}});this.trigger("unsubscribe",[[g]]);delete this.dataHash[e]}},clear:function(){this.data=[];this.dataHash={}},count:function(e){var g=this.dataHash,j=0,l;for(var q in g)if(Ca(e)){l=true;for(var r in e)if(e[r]!=g[q][r])l=false;l&&j++}else j++;return j},get:function(e){return this.dataHash[e]},all:function(e){return e?fa(this.data,function(g){return g.show!="invisible"&&g.presence=="online"}):this.data},complete:function(){var e=
this.dataHash,g=[],j;for(var l in e){j=e[l];if(j.incomplete){j.incomplete=false;g.push(l)}}this.load(g)},update:function(e){this.load(e)},presence:function(e){var g=this.dataHash;e=za(e)?e:[e];for(var j in e){var l=e[j];l.presence=l.presence=="offline"?"offline":"online";l.incomplete=!g[l.id];if(!l.group&&l.id)l.group=l.id.indexOf("vid:")==0?"visitor":l.group}this.set(e)},load:function(e){e=x(e);e.length&&T({type:"get",url:G("buddies"),cache:false,data:{ids:e.join(","),csrf_token:J.csrf_token},context:this,
success:this.set})},set:function(e){var g=this.data,j=this.dataHash,l={};e=e||[];for(var q=e.length,r,p,v,F=0;F<q;F++){r=e[F];if(v=r.id){if(!j[v]){r.presence=r.presence||"online";r.show=r.show?r.show:r.presence=="offline"?"unavailable":"available";j[v]={};g.push(j[v])}r.incomplete=!!r.incomplete;if(p=pa(j[v],r)){r=p.presence||"update";l[r]=l[r]||[];K(j[v],p);l[r].push(j[v])}}}for(var H in l)this.trigger(H,[l[H]]);this.options.active&&this.complete()}});ka("presence",{},{_init:function(){this.data=
this.data||{};this.set(this.data)},get:function(e){return this.data[e]},set:function(e){var g={};for(var j in e){var l=e[j],q="online";if(l=="unavailable"||l=="invisible")q="offline";g[q]=g[q]||[];g[q].push({id:j,show:l})}for(var r in g)this.trigger(r,[g[r]])},update:function(e){for(var g={},j=0;j<e.length;j++){var l=e[j];g[l.from]=l.show}this.set(g)},clear:function(){this.data=[]}});(function(){ka("room",{},{_init:function(){this.data=this.data||[];this.dataHash={}},get:function(e){return this.dataHash[e]},
all:function(e){return e?fa(this.data,function(g){return g.temporary}):this.data},invite:function(e,g,j,l){var q=this,r=q.options;T({type:"post",cache:false,url:G("invite"),data:{ticket:r.ticket,id:e,nick:g||"",members:j.join(","),csrf_token:J.csrf_token},success:function(p){q.set([p]);q.loadMember(e);l&&l(p)}})},join:function(e,g,j){var l=this,q=l.options;T({type:"post",cache:false,url:G("join"),data:{ticket:q.ticket,id:e,nick:g||"",csrf_token:J.csrf_token},success:function(r){l.set([r]);l.loadMember(e);
j&&j(r)}})},leave:function(e){var g=this,j=g.options,l=g.dataHash[e],q=j.user;l&&T({type:"post",cache:false,url:G("leave"),data:{ticket:j.ticket,id:e,nick:q.nick,temporary:l.temporary,csrf_token:J.csrf_token},success:function(){delete g.dataHash[e];g.trigger("leaved",[e])}})},block:function(e){var g=this,j=g.options,l=g.dataHash[e];if(l&&!l.blocked){l.blocked=true;var q=[];O(g.dataHash,function(r,p){!p.temporary&&p.blocked&&q.push(p.id)});T({type:"post",cache:false,url:G("block"),data:{ticket:j.ticket,
id:e,csrf_token:J.csrf_token},success:function(){g.trigger("blocked",[e,q])}})}},unblock:function(e){var g=this,j=g.options,l=g.dataHash[e];if(l&&l.blocked){l.blocked=false;var q=[];O(g.dataHash,function(r,p){!p.temporary&&p.blocked&&q.push(p.id)});T({type:"post",cache:false,url:G("unblock"),data:{ticket:j.ticket,id:e,csrf_token:J.csrf_token},success:function(){g.trigger("unblocked",[e,q])}})}},set:function(e){var g=this,j=g.data,l=g.dataHash;O(e,function(q,r){var p=r.id;if(p){r.members=r.members||
[];r.all_count=r.members.length;r.count=0;O(r.members,function(v,F){if(F.presence=="online")r.count+=1});if(l[p])K(l[p],r);else{l[p]=r;j.push(r)}g.trigger("updated",l[p])}})},loadMember:function(e){var g=this,j=g.options;T({type:"get",cache:false,url:G("members"),data:{ticket:j.ticket,id:e,csrf_token:J.csrf_token},success:function(l){g.updateMember(e,l)}})},updateMember:function(e,g){var j=this.dataHash[e];if(j){j.memberLoaded=true;j.members=g;this.set([j])}},onPresence:function(e){var g=e.type;if(e.to&&
this.dataHash[e.to]){var j=e.to,l=this.dataHash[j];l&&l.memberLoaded&&this.loadMember(j);if(g=="join")this.trigger("memberJoined",[j,e]);else if(g=="leave")this.trigger("memberLeaved",[j,e]);else if(g=="grponline")this.trigger("memberOnline",[j,e]);else g=="grpoffline"&&this.trigger("memberOffline",[j,e])}},clear:function(){this.data=[];this.dataHash={}}})})();ka("history",{},{_init:function(){this.data=this.data||{};this.data.chat=this.data.chat||{};this.data.grpchat=this.data.grpchat||{}},clean:function(){this.data.chat=
{};this.data.grpchat={}},get:function(e,g){return this.data[e][g]},set:function(e){var g=this.data,j={chat:{},grpchat:{}};e=la(e);var l=e.length,q,r,p=this.options.userInfo.id;if(l){for(var v=0;v<l;v++){q=e[v];F=q.type;if((r=F=="chat"?q.to==p?q.from:q.to:q.to)&&F){j[F][r]=j[F][r]||[];j[F][r].push(q)}}for(var F in j)for(r in j[F]){q=j[F][r];if(g[F][r]){g[F][r]=[].concat(g[F][r]).concat(q);this._triggerMsg(F,r,q)}else this.load(F,r)}}},_triggerMsg:function(e,g,j){this.trigger(e,[g,j])},clear:function(e,
g){this.data[e][g]=[];this.trigger("clear",[e,g]);T({url:G("clear"),type:"post",cache:false,data:{type:e,id:g,csrf_token:J.csrf_token}})},download:function(e,g){var j=G("download"),l=D.createElement("iframe"),q=new Date,r=[];q={id:g,type:e,time:(new Date).getTime(),date:q.getFullYear()+"-"+(q.getMonth()+1)+"-"+q.getDate()};for(var p in q)r[r.length]=encodeURIComponent(p)+"="+encodeURIComponent(q[p]);j+=(/\?/.test(j)?"&":"?")+r.join("&");l.setAttribute("src",j);l.style.display="none";D.body.appendChild(l)},
init:function(e,g,j){if(za(j)){this.data[e][g]=j;this._triggerMsg(e,g,j)}},load:function(e,g){var j=this;j.data[e][g]=[];T({url:G("history"),cache:false,type:"get",data:{type:e,id:g,csrf_token:J.csrf_token},success:function(l){j.init(e,g,l)}})}})})(window,document);
(function(y,D,ja){function xa(){return false}function za(a){var b="";if(a.length==0)return"";b=a.replace(/&/g,"&amp;");b=b.replace(/</g,"&lt;");b=b.replace(/>/g,"&gt;");b=b.replace(/    /g,"&nbsp;");b=b.replace(/\'/g,"&#39;");b=b.replace(/\"/g,"&quot;");return b=b.replace(/\n/g,"<br />")}function Ca(a){return/^http:\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"])*$/.test(a)}function Aa(a){return a?a.replace(/<(?:.|\s)*?>/g,""):""}function pa(a,b){for(var c=[];a;a=a.nextSibling)a.nodeType==
1&&a!=b&&c.push(a);return c}function la(a,b){return a&&RegExp("(^|\\s+)"+b+"(\\s+|$)").test(a.className)}function K(a,b){if(a)la(a,b)||(a.className+=" "+b)}function O(a,b){a&&(a.className=a.className.replace(RegExp("(^|\\s+)("+b.split(/\s+/).join("|")+")(?=(\\s+|$))","g")," "))}function fa(a,b,c){a&&(a.className=a.className.replace(RegExp("(^|\\s+)("+b.split(/\s+/).join("|")+")(?=(\\s+|$))","g")," ")+" "+c)}function qa(a,b,c){x(a,"mouseover",function(){K(this,b);c&&O(this,c)});x(a,"mouseout",function(){O(this,
b);c&&K(this,c)})}function ga(a,b,c){if(typeof c==="boolean")c?K(a,b):O(a,b);else la(a,b)?O(a,b):K(a,b)}function M(a){a&&a.style&&(a.style.display="block")}function B(a){a&&a.style&&(a.style.display="none")}function ra(a){a&&a.parentNode&&a.parentNode.removeChild(a)}function J(a,b){var c=a.childNodes;for(i=0;i<c.length;i++)a.removeChild(c[i]);typeof b==="string"?a.innerHTML=b:a.appendChild(b)}function x(a,b,c){if(a.addEventListener)a.addEventListener(b,c,false);else{a["e"+b+c]=c;a[b+c]=function(){return a["e"+
b+c](y.event)};a.attachEvent("on"+b,a[b+c])}}function ka(a){if(a){a.stopPropagation&&a.stopPropagation();a.cancelBubble=true}}function G(a){if(a){a.preventDefault&&a.preventDefault();a.returnValue=false}}function ya(a){if(!a.target)a.target=a.srcElement||D;if(a.target.nodeType===3)a.target=a.target.parentNode;return a.target}function T(a){a.setAttribute("unselectable","on");a.style.MozUserSelect="none";a.style.OUserSelect="none";a.style.WebkitUserSelect="none";x(a,"selectstart",xa)}function na(){if(!Ba){Ba=
true;if(sa){for(var a,b=0;a=sa[b++];)a();sa=null}}}function e(){if(!Ea){Ea=true;if(D.readyState==="complete")return na();if(D.addEventListener)D.addEventListener("DOMContentLoaded",function(){D.removeEventListener("DOMContentLoaded",arguments.callee,false);na()},false);else if(D.attachEvent){D.attachEvent("onreadystatechange",function(){if(D.readyState==="complete"){D.detachEvent("onreadystatechange",arguments.callee);na()}});D.documentElement.doScroll&&y==y.top&&function(){if(!Ba){try{D.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,
0);return}na()}}()}x(y,"load",na)}}function g(a){var b=new Date;b.setTime(a?parseFloat(a)+g.timeSkew:(new Date).getTime());this.date=b}function j(a,b,c){if(a.addEventListener)a.addEventListener(b,c,false);else{a["e"+b+c]=c;a[b+c]=function(){return a["e"+b+c](y.event)};a.attachEvent("on"+b,a[b+c])}}function l(a){a&&a.parentNode&&a.parentNode.removeChild(a)}function q(a){return a?y.JSON&&y.JSON.parse?y.JSON.parse(a):(new Function("return "+a))():a}function r(a,b,c){j(a,"submit",function(){function d(){try{var o=
h.contentWindow.name||null;if(o!=null){l(f);b&&b(q(o))}else throw Error("Empty data");}catch(z){l(f);b&&b({error:"Retrieve data error"})}}c&&c();a.setAttribute("target","_upload_form13123");var f=D.createElement("div");f.innerHTML='<iframe name="_upload_form13123" id="_upload_form13123" style="display:none;" scrolling="no" frameborder="0"></iframe>';var h=f.firstChild;D.body.appendChild(f);if(y.postMessage){var m=function(o){var z=y,s=m;if(z.addEventListener)z.removeEventListener("message",s,false);
else{z.detachEvent("onmessage",z["message"+s]);z["message"+s]=null}l(f);b&&b(q(o.data))};j(y,"message",m)}else{var k=false;j(h,"load",function(){if(k)y.attachEvent||d();else{k=true;h.contentWindow.location="about:blank"}});if(y.attachEvent)h.onreadystatechange=function(){k&&d()}}})}function p(a,b,c){c=L({locale:p.locale},c);c=p.dictionary[c.locale];E(c)||(c={});a=c[a]===ja?a:c[a];if(b){va=b;for(var d in b)a=a.replace(/\{\{(.*?)\}\}/g,I)}return a}function v(a,b){this.element=a;this.options=L({},v.defaults,
b);this._init()}function F(a){a=a.getElementsByTagName("*");for(var b,c,d={},f=a.length-1;f>-1;f--){b=a[f];if((c=b.id)&&c.indexOf(":")==0)d[c.substring(1,c.length)]=b}return d}function H(a){var b=D.createElement("div");b.innerHTML=a;return b=b.firstChild}function P(a,b,c){function d(f,h){this.id=Ha++;this.name=a;this.className="webim-"+a;this.options=L({},d.defaults,h);if(this.element=f||this.template&&H(this.template())||this.options.template&&H(U(this.options.template))){this.options.className&&
K(this.element,this.options.className);this.$=F(this.element)}u(this._init)&&this._init();u(this._initEvents)&&this._initEvents()}d.defaults=b;Da.on(d);L(d.prototype,P.prototype,c);v[a]=d}function da(a,b){v.apps[a]=b||{}}function ma(a,b){return b?a=="b"||a=="buddy"||a=="chat"?"b_"+b:"r_"+b:a}function Y(){D.selection&&(this.caretPos=D.selection.createRange())}function ua(){return"xx4xyxyxxxyxyyxy".replace(/[xy]/g,function(a){var b=Math.random()*16|0;return(a=="x"?b:b&3|8).toString(16)})}var N=webim.idsArray,
u=webim.isFunction,n=webim.isArray,E=webim.isObject,R=webim.trim,S=webim.makeArray,L=webim.extend,C=webim.each,ha=webim.grep,ia=webim.ajax,W=webim.model,Da=webim.ClassEvent,X=webim.route,aa=webim.map,Ba=false,sa=[],Ea=false;g.timeSkew=0;g.init=function(a){g.timeSkew=(new Date).getTime()-parseFloat(a)};L(g.prototype,{getTime:function(){var a=this.date,b=a.getHours();a=a.getMinutes();if(a<10)a="0"+a;return b+":"+a+""},getDay:function(a){var b=this.date;if(a){a=new Date;a.setHours(0);a.setMinutes(0);
a.setSeconds(0);a.setMilliseconds(0);a=a.getTime()-b.getTime();if(a<=0)return p("dt:today");else if(a<864E5)return p("dt:yesterday")}return p("dt:monthdate",{month:p(["dt:january","dt:february","dt:march","dt:april","dt:may","dt:june","dt:july","dt:august","dt:september","dt:october","dt:november","dt:december"][b.getMonth()]),date:b.getDate()})}});var ta=function(){var a=true,b={lib:"sound.swf",msg:"sound/msg.mp3"};return{enable:function(){a=true},disable:function(){a=false},init:function(c){L(b,
c);if(!y.Audio&&navigator.userAgent.indexOf("MSIE")>=0){c=D.createElement("bgsound");c.id="webim-bgsound";c.src="#";c.autostart="true";c.loop="1";D.getElementById("webim-flashlib-c").appendChild(c)}},play:function(c){c=Ca(c)?c:b[c];if(a)if(y.Audio){if(!d)var d=new Audio;d.src=c;d.play()}else if(navigator.userAgent.indexOf("MSIE")>=0)try{D.getElementById("webim-bgsound").src=c?c:"/sound/sound.mp3"}catch(f){}}}}(),Fa=function(){var a=false;x(y,"focus",function(){a=false});x(y,"blur",function(){a=true});
var b=D.title,c=0,d=false;return function(f,h){if(a){if(m){clearInterval(m);c=0;d=false}var m=setInterval(function(){c++;d=!d;if(c==h||!a){clearInterval(m);c=0;d=false}D.title=d?"["+f+"]"+b:b},1500)}}}(),va={},I=function(a,b){return va[b]||""};p.locale="zh-CN";p.dictionary={};p.store=function(a,b){var c=p.dictionary;E(c[a])||(c[a]={});L(c[a],b)};Da.on(v);L(v.prototype,{render:function(){var a=this,b=a.layout;a.element.insertBefore(b.element,a.element.firstChild);setTimeout(function(){a.initSound()},
1E3);b.buildUI()},_init:function(){var a=this.im=new webim(null,this.options.imOptions),b=this.options;this.layout=this.addApp(b.layout||"layout",b.layoutOptions);a.setting.get("play_sound")?ta.enable():ta.disable();a.bind("online",function(c,d){g.init(d.server_time)});a.setting.bind("update",function(c,d,f){if("play_sound"==d)f?ta.enable():ta.disable()})},addApp:function(a,b){var c=v.apps[a];if(c)return u(c)&&c.apply(this,[b])},initSound:function(a){ta.init(a||this.options.soundUrls)}});var wa=function(a,
b){if(b===ja)return parseInt(a.innerHTML);else if(b){b=typeof b=="number"?b:parseInt(a.innerHTML)+parseInt(b);a.innerHTML=b.toString();M(a)}else{a.innerHTML="0";B(a)}return b},U=function(){function a(d,f){return b&&b[f]!=ja?b[f]:p(f)}var b=null,c=/\<\%\=(.*?)\%\>/ig;return function(d,f){if(!d)return"";b=f;return d.replace(c,a)}}(),ba={add:function(a,b,c){a=v[a].prototype;for(var d in c){a.plugins[d]=a.plugins[d]||[];a.plugins[d].push([b,c[d]])}},call:function(a,b,c){if((b=a.plugins[b])&&a.element.parentNode)for(var d=
0;d<b.length;d++)a.options[b[d][0]]&&b[d][1].apply(a.element,c)}},Ha=1;L(P.prototype,{_init:function(){}});L(v,{version:"5.4 ",widget:P,app:da,plugin:ba,i18n:p,date:g,ready:function(a){e();Ba?a():sa.push(a)},createElement:H,defaults:{},apps:{}});webim.ui=v;P("window",{isMinimize:false,minimizable:true,detachable:false,maximizable:false,closeable:true,sticky:true,titleVisibleLength:12,count:0,template:'<div id=":webim-window" class="webim-window ui-widget">                                            <div class="webim-window-tab-wrap">                                            <div id=":tab" class="webim-window-tab ui-state-default">                                            <div class="webim-window-tab-inner">                                                    <div id=":tabTip" class="webim-window-tab-tip">                                                            <strong id=":tabTipC"><%=tooltip%></strong>                                                    </div>                                                    <a id=":tabClose" title="<%=close%>" class="webim-window-close" href="#close"><em class="ui-icon ui-icon-close"><%=close%></em></a>                                                    <div id=":tabCount" class="webim-window-tab-count">                                                            0                                                    </div>                                                    <em id=":tabIcon" class="webim-icon webim-icon-comments"></em>                                                    <h4 id=":tabTitle"><%=title%></h4>                                            </div>                                            </div>                                            </div>                                            <div><div id=":window" class="webim-window-window">\t\t\t\t\t\t<iframe id=":bgiframe" class="webim-bgiframe" frameborder="0" tabindex="-1" src="about:blank;" ></iframe>                                                    <div id=":header" class="webim-window-header ui-widget-header ui-corner-top">                                                            <span id=":actions" class="webim-window-actions">                                                                    <a id=":minimize" title="<%=minimize%>" class="webim-window-minimize" href="#minimize"><em class="ui-icon ui-icon-minus"><%=minimize%></em></a>                                                                    <a id=":detach" title="<%=detach%>" class="webim-window-detach" href="#detach"><em class="ui-icon ui-icon-arrowthick-1-ne"><%=detach%></em></a>                                                                    <a id=":maximize" title="<%=maximize%>" class="webim-window-maximize" href="#maximize"><em class="ui-icon ui-icon-plus"><%=maximize%></em></a>                                                                    <a id=":close" title="<%=close%>" class="webim-window-close" href="#close"><em class="ui-icon ui-icon-close"><%=close%></em></a>                                                            </span>                                                            <h4 id=":headerTitle"><%=title%></h4>                                                            <div id=":subHeader" class="webim-window-subheader"></div>                                                    </div>                                                    <div id=":content" class="webim-window-content ui-widget-content">                                                    </div>                                            </div>                                            </div>                                            </div>'},
{html:function(a){J(this.$.content,a)},subHeader:function(a){J(this.$.subHeader,a)},_init:function(a,b){b=this.options;var c=this.$;a=this.element;a.window=this;b.tabWidth&&(c.tab.style.width=b.tabWidth+"px");b.subHeader&&this.subHeader(b.subHeader);this.title(b.title,b.icon);!b.minimizable&&B(c.minimize);!b.maximizable&&B(c.maximize);!b.detachable&&B(c.detach);if(!b.closeable){B(c.tabClose);B(c.close)}b.isMinimize?this.minimize():this.restore();this.position={right:0,bottom:0};if(b.detached){this.position.right=
b.detached.right;this.position.bottom=b.detached.bottom;this.detach()}b.onlyIcon?B(c.tabTitle):ra(c.tabTip);b.count&&this.notifyUser("information",b.count);Ga(this)},notifyUser:function(a,b){var c=this.$;if(a=="information")if(this.isMinimize())if(wa(c.tabCount,b)){K(c.tab,"ui-state-highlight");O(c.tab,"ui-state-default")}},_count:function(){return wa(this.$.tabCount)},title:function(a,b){var c=this.$,d=c.tabIcon;if(b)if(Ca(b)){d.className="webim-icon";d.style.backgroundImage="url("+b+")"}else d.className=
"webim-icon webim-icon-"+b;c.tabTipC.innerHTML=a;d=this.options.titleVisibleLength;if(a){for(var f=0,h=[],m=a.split(""),k=m.length,o=0;o<k;o++)if(f>=d||f<0)break;else{if(m[o].charCodeAt(0)>255)f+=2;else f++;h.push(m[o])}d=h.join("")}else d=a;(c.tabTitle.innerHTML=d)&&a&&d.length<a.length&&c.tabTitle.setAttribute("title",a);c.headerTitle.innerHTML=a},_changeState:function(a){fa(this.element,"webim-window-normal webim-window-maximize webim-window-minimize","webim-window-"+(a=="restore"?"normal":a));
this.trigger("displayStateChange",[a])},active:function(){return la(this.element,"webim-window-active")},activate:function(){if(!this.active()){K(this.element,"webim-window-active");this.trigger("activate")}},deactivate:function(){if(this.active()){O(this.element,"webim-window-active");this.options.sticky||this.minimize();this.trigger("deactivate")}},_setVisibile:function(){var a=this.$;this.isDetached()?B(a.tab):fa(a.tab,"ui-state-default ui-state-highlight","ui-state-active");this.activate();wa(a.tabCount,
0)},maximize:function(){if(!this.isMaximize()){this._setVisibile();this._changeState("maximize")}},restore:function(){if(!la(this.element,"webim-window-normal")){this._setVisibile();this._changeState("restore")}},minimize:function(){if(!this.isMinimize()){M(this.$.tab);fa(this.$.tab,"ui-state-active","ui-state-default");this.deactivate();this._changeState("minimize")}},tabClose:function(){this.close()},close:function(){this.trigger("close");ra(this.element)},detach:function(){var a=this.position,
b=this.$.window,c=this.$.detach;if(!this.isDetached()){B(this.$.tab);b.style.bottom=a.bottom+"px";b.style.right=a.right+"px";fa(c.firstChild,"ui-icon-arrowthick-1-ne","ui-icon-arrowthick-1-sw");this.detached=true}},isDetached:function(){return this.detached||false},attach:function(){var a=this.position,b=this.$.window,c=this.$.detach;M(this.$.tab);a.right=0;a.bottom=0;b.style.bottom="26.4px";b.style.right="0px";fa(c.firstChild,"ui-icon-arrowthick-1-sw","ui-icon-arrowthick-1-ne");this.detached=false},
_beforeMove:function(a){var b=this.position,c=this.$.window;if(c.style.right)b.right=parseInt(c.style.right);if(c.style.bottom)b.bottom=parseInt(c.style.bottom);b.right=b.right||0;b.bottom=b.bottom||0;b.mouseX=a.pageX||a.clientX;b.mouseY=a.pageY||a.clientY},move:function(a){var b=this.position,c=this.$.window,d=(a.pageX||a.clientX)-b.mouseX,f=(a.pageY||a.clientY)-b.mouseY;b.mouseX=a.pageX||a.clientX;b.mouseY=a.pageY||a.clientY;b.right-=d;b.bottom-=f;c.style.right=b.right+"px";c.style.bottom=b.bottom+
"px"},_initEvents:function(){var a=this,b=a.$,c=b.tab,d=b.header,f=function(m){ka(m);G(m)};if(a.options.detachable){x(b.detach,"click",function(m){a.isDetached()?a.attach():a.detach();f(m)});var h=function(m){a.move(m)};x(d,"mouseover",function(){d.style.cursor=a.isDetached()?"move":"default"});x(d,"mousedown",function(m){if(a.isDetached()){a._beforeMove(m);x(d,"mousemove",h)}});x(d,"mouseup",function(){if(d.addEventListener)d.removeEventListener("mousemove",h,false);else{d.detachEvent("onmousemove",
d["mousemove"+h]);d["mousemove"+h]=null}})}x(c,"click",function(m){a.isMinimize()?a.restore():a.minimize();f(m)});x(c,"mouseover",function(){K(this,"ui-state-hover");O(this,"ui-state-default")});x(c,"mouseout",function(){O(this,"ui-state-hover");this.className.indexOf("ui-state-")==-1&&K(this,"ui-state-default")});x(c,"mousedown",f);T(c);C(pa(b.actions.firstChild),function(m,k){qa(k,"ui-state-hover")});C(["minimize","maximize","close","tabClose"],function(m,k){x(b[k],"click",function(o){this.disable||
a[k]();f(o)});x(b[k],"mousedown",f)})},height:function(){return this.$.content.offsetHeight},_fitUI:function(){},isMaximize:function(){return la(this.element,"webim-window-maximize")},isMinimize:function(){return la(this.element,"webim-window-minimize")}});var Ga=function(){var a=false,b=function(){a&&a.deactivate();a=false;return true},c=function(){this&&this!=a&&b()&&(a=this)},d=function(){this&&a==this&&(a=false)};x(D,"mousedown",function(f){f=ya(f);for(var h;f;)if(f.id==":webim-window"){h=f;break}else f=
f.parentNode;if(h)(f=h.window)&&f.activate();else b()});return function(f){if(f.active()){b();a=f}f.bind("activate",c);f.bind("deactivate",d)}}();da("layout",function(a){function b(t){if(f)return s.updateAllChat();f=true;var A=k.get("tabs"),w=k.get("tabIds"),Q=k.get("p"),$=k.get("a");w&&w.length&&A&&C(A,function(V,Z){var ca=V.slice(2),oa=V.slice(0,1);if(!(oa=="r"&&!t.room.get(ca))){s.addChat(oa,ca,{},{isMinimize:true});s.chat(V).window.notifyUser("information",Z.n)}});Q&&(s.prevCount=Q)&&s._fitUI();
$&&s.focusChat($)}function c(){var t={};C(s.tabs,function(A,w){t[A]={n:w._count()}});k.set({tabs:t,tabIds:s.tabIds,p:s.prevCount,a:s.activeTabId})}a=a||{};var d=this.im,f=false,h=d.buddy,m=d.history,k=d.status,o=d.setting,z=d.room,s=this.layout=new v.layout(null,L({chatAutoPop:d.setting.get("msg_auto_pop")},a,{ui:this}));d.setting.get("minimize_layout")?s.collapse():s.expand();d.bind("beforeOnline",function(){s.changeState("ready")}).bind("online",function(t,A){s.changeState("active");s.options.user=
A.user;b(d)}).bind("offline",function(t,A){A=="offline"&&s.removeAllChat();s.updateAllChat();s.changeState("stop")});o.bind("update",function(t,A,w){if("msg_auto_pop"==A)s.options.chatAutoPop=w;else if("minimize_layout"==A)w?s.collapse():s.expand()});h.bind("online",function(t,A){s.updateChat("buddy",A)}).bind("offline",function(t,A){s.updateChat("buddy",A)}).bind("update",function(t,A){s.updateChat("buddy",A)});s.bind("collapse",function(){o.set("minimize_layout",true)});s.bind("expand",function(){o.set("minimize_layout",
false)});s.bind("displayUpdate",function(){c()});(function(){z.bind("memberAdded",function(t,A,w){(t=s.chat("room",A))&&t.addMember(w.id,w.nick,w.id==d.data.user.id)}).bind("memberRemoved",function(t,A,w){(t=s.chat("room",A))&&t.removeMember(w.id,w.nick)}).bind("updated",function(t,A){var w=s.chat("room",A.id);w&&w.updateRoom(A)})})();d.bind("message",function(t,A){for(var w=false,Q=A.length,$,V=d.data.user.id,Z,ca,oa=0;oa<Q;oa++){$=A[oa];Z=$.id;type=$.type;(ca=s.chat(type,Z))&&ca.status("");if(!ca){$.type===
"chat"?s.addChat(type,Z,null,null,$.nick):s.addChat(type,Z);ca=s.chat(type,Z)}ca&&o.get("msg_auto_pop")&&!s.activeTabId&&s.focusChat(Z);ca.window.notifyUser("information","+1");Z=ca.window.pos;Z==-1&&s.setNextMsgNum("+1");Z==1&&s.setPrevMsgNum("+1");if($.from!=V)w=true}if(w){ta.play("msg");Fa(p("new message"),5)}});d.bind("status",function(t,A){C(A,function(w,Q){var $=d.data.user.id,V=Q.from;if(!($!=Q.to&&$!=Q.from))($=s.chat("buddy",V))&&$.status(Q.show)})});(function(){m.bind("chat",function(t,
A,w){(t=s.chat("chat",A))&&t.history.add(w)});m.bind("grpchat",function(t,A,w){(t=s.chat("grpchat",A))&&t.history.add(w)});m.bind("clear",function(t,A,w){(t=s.chat(A,w))&&t.history.clear()})})();return s});P("layout",{template:'<div id="webim" class="webim webim-state-ready">\t<div class="webim-preload ui-helper-hidden-accessible">\t<div id="webim-flashlib-c">\t</div>\t</div>\t<div id=":layout" class="webim-layout"><iframe class="webim-bgiframe" frameborder="0" tabindex="-1" src="about:blank;" ></iframe><div class="webim-layout-bg ui-state-default ui-toolbar"></div><div class="webim-ui ui-helper-clearfix">\t<div id=":shortcut" class="webim-shortcut">\t</div>\t<div class="webim-layout-r">\t<div id=":panels" class="webim-panels">\t<div class="webim-window-tab-wrap ui-widget webim-panels-next-wrap">\t<div id=":next" class="webim-window-tab webim-panels-next ui-state-default">\t<div id=":nextMsgCount" class="webim-window-tab-count">\t0\t</div>\t<em class="ui-icon ui-icon-triangle-1-w"></em>\t<span id=":nextCount">0</span>\t</div>\t</div>\t<div id=":tabsWrap" class="webim-panels-tab-wrap">\t<div id=":tabs" class="webim-panels-tab">\t</div>\t</div>\t<div class="webim-window-tab-wrap ui-widget webim-panels-prev-wrap">\t<div id=":prev" class="webim-window-tab webim-panels-prev ui-state-default">\t<div id=":prevMsgCount" class="webim-window-tab-count">\t0\t</div>\t<span id=":prevCount">0</span>\t<em class="ui-icon ui-icon-triangle-1-e"></em>\t</div>\t</div>\t<div class="webim-window-tab-wrap webim-collapse-wrap ui-widget">\t<div id=":collapse" class="webim-window-tab webim-collapse ui-state-default" title="<%=collapse%>">\t<em class="ui-icon ui-icon-circle-arrow-e"></em>\t</div>\t</div>\t<div class="webim-window-tab-wrap webim-expand-wrap ui-widget">\t<div id=":expand" class="webim-window-tab webim-expand ui-state-default" title="<%=expand%>">\t<em class="ui-icon ui-icon-circle-arrow-w"></em>\t</div>\t</div>\t</div>\t<div id=":widgets" class="webim-widgets">\t</div>\t</div>\t</div></div>\t</div>',
shortcutLength:5,chatAutoPop:true,tpl_shortcut:'<div class="webim-window-tab-wrap ui-widget webim-shortcut-item"><a class="webim-window-tab" href="<%=link%>" target="<%=target%>">\t<div class="webim-window-tab-tip">\t<strong><%=title%></strong>\t</div>\t<em class="webim-icon" style="background-image:url(<%=icon%>)"></em>\t</a>\t</div>',chatApp:"chat"},{_init:function(a,b){b=this.options;L(this,{window:y,widgets:{},panels:{},tabWidth:136,maxVisibleTabs:null,animationTime:210,activeTabId:null,tabs:{},
tabIds:[],nextCount:0,prevCount:0});b.unscalable&&K(this.$.layout,"webim-layout-unscalable");b.isMinimize&&this.collapse()},changeState:function(a){this.element.className="webim webim-state-"+a},_ready:false,buildUI:function(){var a=this.$;this.maxVisibleTabs=parseInt(((D.compatMode==="CSS1Compat"&&D.documentElement.clientWidth||D.body.clientWidth)-45-a.shortcut.offsetWidth-a.widgets.offsetWidth-70-105)/this.tabWidth);this._fitUI();this.options.disableResize||this._autoResizeWindow();this._ready=
true},_autoResizeWindow:function(){var a=this.$.widgets.offsetWidth;for(var b in this.widgets){var c=this.widgets[b]&&this.widgets[b].window;if(c=c&&c.$&&c.$.window)c.style.width=a+"px"}},_updatePrevCount:function(a){var b=this.tabIds,c=this.maxVisibleTabs,d=b.length,f=this.prevCount;if(!(d<=c)){if(a){for(var h=0,m=0;m<d;m++)if(b[m]==a){h=m;break}if(h<=f)f=h;else if(h>=f+c)f=h-c+1}else f=d-c;this.prevCount=f}},_setVisibleTabs:function(a){for(var b=this.prevCount,c=b+this.maxVisibleTabs,d=this.tabs,
f=this.tabIds,h=f.length,m=0,k=0,o=0;o<h;o++){var z=d[f[o]];if(o<b||o>=c)if(a)M(z.element);else{this.activeTabId==f[o]&&z.minimize();var s=z._count();if(o<b){k+=s;z.pos=1}else{m+=s;z.pos=-1}B(z.element)}else{z.pos=0;M(z.element)}}if(!a){this.setNextMsgNum(m);this.setPrevMsgNum(k)}},setNextMsgNum:function(a){wa(this.$.nextMsgCount,a)},setPrevMsgNum:function(a){wa(this.$.prevMsgCount,a)},slideing:false,_slide:function(a){var b=this,c=b.prevCount,d=b.nextCount;if(d>0&&a==-1||c>0&&a==1){b.slideing=true;
if(d==1&&a==-1||c==1&&a==1)b.slideing=false;b._slideSetup(false);b._setVisibleTabs(true);if(a==-1){b.nextCount--;b.prevCount++}else if(a==1){b.nextCount++;b.prevCount--}var f=b.$.tabs,h=parseFloat(f.style.left);c=-1*b.tabWidth*b.nextCount;var m=parseInt(500/13),k=1,o=(c-h)/m,z=setInterval(function(){f.style.left=h+o*k+"px";if(k==m){if(b.slideing)b._slide(a);else{b._fitUI();b._slideReset()}clearInterval(z)}else k++},13)}},_slideUp:function(){this.slideing=false},_slideSetup:function(a){var b=this.$,
c=b.tabsWrap;b=b.tabs;if(!this._tabsWidth)this._tabsWidth=b.clientWidth;if(a)this._tabsWidth=null;c.style.position=a?"":"relative";c.style.overflow=a?"visible":"hidden";c.style.width=a?"":this._tabsWidth+"px";b.style.width=a?"":this.tabWidth*this.tabIds.length+"px";b.style.position=a?"":"relative"},_slideReset:function(){this._slideSetup(true)},_updateCount:function(){var a=this.maxVisibleTabs,b=this.tabIds.length,c=this.prevCount,d=this.nextCount;if(b<=a)c=d=0;else{d=b-a-c;d=d<0?0:d;c=b-a-d}this.prevCount=
c;this.nextCount=d},_updateCountUI:function(){var a=this.$,b=this.prevCount,c=this.nextCount;c<=0?K(a.next,"ui-state-disabled"):O(a.next,"ui-state-disabled");b<=0?K(a.prev,"ui-state-disabled"):O(a.prev,"ui-state-disabled");if(b>0||c>0){a.next.style.display="block";a.prev.style.display="block"}else{B(a.next);B(a.prev)}a.nextCount.innerHTML=c.toString();a.prevCount.innerHTML=b.toString()},_initEvents:function(){var a=this,b=a.$,c=false;x(a.window,"resize",function(){if(c){c=true;a.buildUI()}});x(b.next,
"mousedown",function(){a._slide(-1)});x(b.next,"mouseup",function(){a._slideUp()});T(b.next);x(b.prev,"mousedown",function(){a._slide(1)});x(b.prev,"mouseup",function(){a._slideUp()});T(b.prev);x(b.expand,"click",function(){if(!a.isMinimize())return false;a.expand();a.trigger("expand");return false});x(b.collapse,"click",function(){if(a.isMinimize())return false;a.collapse();a.trigger("collapse");return false});qa(b.collapse,"ui-state-hover","ui-state-default");qa(b.expand,"ui-state-hover","ui-state-default")},
isMinimize:function(){return la(this.$.layout,"webim-layout-minimize")},collapse:function(){this.isMinimize()||K(this.$.layout,"webim-layout-minimize")},expand:function(){this.isMinimize()&&O(this.$.layout,"webim-layout-minimize")},_displayUpdate:function(){this._ready&&this.trigger("displayUpdate")},_fitUI:function(){this._updateCount();this.$.tabs.style.left=-1*this.tabWidth*this.nextCount+"px";this._updateCountUI();this._setVisibleTabs();this._displayUpdate()},_stickyWin:null,_widgetStateChange:function(a,
b){b!="minimize"&&C(this.widgets,function(c,d){d.window!=a&&d.window.minimize()});this._displayUpdate()},widget:function(a){return this.widgets[a]},addWidget:function(a,b,c,d){var f=this;b=L(b,{closeable:false,subHeader:a.header});var h=a.element;b=new v.window(null,b);b.html(h);f.$[d?d:"widgets"].insertBefore(b.element,c&&f.widgets[c]?f.widgets[c].window.element:null);a.window=b;b.bind("displayStateChange",function(m,k){f._widgetStateChange(this,k)});f.widgets[a.name]=a},focusChat:function(a,b){b=
ma(a,b);var c=this.tabs[b],d=this.panels[b];c&&c.isMinimize()&&c.restore();d&&d.focus()},chat:function(a,b){return this.panels[ma(a,b)]},updateChat:function(a,b){b=S(b);for(var c,d=b.length,f,h=0;h<d;h++){c=b[h];(f=this.panels[ma(a,c.id)])&&f.update(c)}},updateAllChat:function(){C(this.panels,function(a,b){b.update()})},_onChatClose:function(a){this.tabIds=ha(this.tabIds,function(b){return b!=a});delete this.tabs[a];delete this.panels[a];this._changeActive(a,true);this._fitUI()},_onChatChange:function(a,
b){if(b=="minimize"){this._changeActive(a,true);this._displayUpdate()}else{this._changeActive(a);this._fitUI()}},_changeActive:function(a,b){var c=this.activeTabId;if(b)c==a&&(this.activeTabId=null);else{var d=this.tabs[c];c&&c!=a&&!d.isDetached()&&d.minimize();this.activeTabId=a;this._updatePrevCount(a)}},addChat:function(a,b,c,d,f){a=a=="b"||a=="buddy"||a=="chat"?"buddy":"room";var h=this;if(!h.chat(a,b)){var m=h.panels,k=ma(a,b);d=h.tabs[k]=(new v.window(null,L({isMinimize:h.activeTabId||!h.options.chatAutoPop,
tabWidth:h.tabWidth-2,detachable:h.options.detachable||false,titleVisibleLength:9},d))).bind("close",function(){h._onChatClose(k)}).bind("displayStateChange",function(o,z){h._onChatChange(k,z)});a=h.options.ui.addApp(h.options.chatApp,L({id:b,type:a,nick:f,window:d},c));m[k]=a;h.tabIds.push(k);h.$.tabs.insertBefore(d.element,h.$.tabs.firstChild);!d.isMinimize()&&h._changeActive(k);h._fitUI()}},removeChat:function(a,b){var c=this.tabs[ma(a,b)];c&&c.close()},removeAllChat:function(){C(this.tabs,function(a,
b){b.close()})},addShortcut:function(a){var b=this;if(n(a))C(a,function(f,h){b.addShortcut(h)});else if(E(a)){var c=b.$.shortcut,d=b.options.tpl_shortcut;if(!(c.childNodes.length>b.options.shortcutLength+1)){d=H(U(d,{title:p(a.title),icon:a.icon,link:a.link,target:a.isExtlink?"_blank":""}));qa(d.firstChild,"ui-state-hover");c.appendChild(d)}}}});P("history",{user:{},info:{},template:'<div class="webim-history">                        <div id=":content" class="webim-history-content">                 </div></div>'},
{_init:function(){ba.call(this,"init",[null,this.ui()])},clear:function(){this.$.content.innerHTML="";this.trigger("clear")},add:function(a){a=S(a);var b=this,c=a.length,d=[];if(c){for(var f=0;f<c;f++)d.push(b._renderMsg(a[f]));a=H("<div>"+d.join("")+"</div>");d=a.getElementsByTagName("img");f=0;for(c=d.length;f<c;f++)x(d[f],"load",function(){b.trigger("update")});b.$.content.appendChild(a);b.trigger("update")}},notice:function(a,b){this.$.content.appendChild(H('<div class="webim-history-notice ui-state-default ui-state-'+
a+'">'+b+"</div>"));this.trigger("update")},_renderMsg:function(a){a=L({},a);ba.call(this,"render",[null,this.ui({msg:a})]);var b=a.from,c=a.to,d=a.timestamp,f=a.body,h=true,m=this._lastLogItem,k=[],o;o=a.nick;if(m&&m.to==c&&m.from==b&&d-m.timestamp<6E4)h=false;if(h){this._lastLogItem=a;b=new g(d);k.push('<h4><span class="webim-gray">');k.push(b.getDay(true));k.push(" ");k.push(b.getTime());k.push("</span>");k.push(o);k.push('</h4><hr class="webim-line ui-state-default" />')}a.style?k.push('<p style="'+
a.style+'">'):k.push("<p>");k.push(f);k.push("</p>");return k.join("")},_renderDateBreak:function(a){var b=this._lastLogItem,c=new Date,d=new Date,f=[];c.setTime(a);b&&d.setTime(b.timestamp);if(!b||c.getDate()!=d.getDate()||c.getMonth()!=d.getMonth()){f.push("<h5>");f.push((new g(a)).getDay(true));f.push("</h5>")}return f.join("")},ui:function(a){return L({element:this.element,$:this.$},a)},plugins:{}});var ea=function(){function a(d,f,h,m,k,o,z,s){if(f)return'<a href="'+(f=="www."?"http://"+d:d)+
'"'+c+">"+d+"</a>";if(m)return'<a class="webim-img" href="'+o+'"'+c+'><img src="'+(s||o)+'" alt="'+(k||o)+'"/></a>';return'<a class="webim-file" href="'+o+'"'+c+">"+(k||o)+"</a>"}function b(d,f){c+=" "+d+'="'+f+'"'}var c;return function(d,f){c="";f&&E(f)&&C(f,b);return d.replace(/(https?:\/\/|www\.)([^\s<]+)|(\!?)\[([^\]]*)\]\(([^\)]+)\)(\(([^\)]+)\))?/ig,a)}}();v.history.defaults.parseMsg=true;ba.add("history","parseMsg",{render:function(a,b){var c=b.msg.body;c=za(c);c=ea(c,{target:"_blank"});b.msg.body=
c}});v.history.defaults.emot=true;ba.add("history","emot",{render:function(a,b){b.msg.body=v.emot.parse(b.msg.body)}});P("emot",{template:'<div class="webim-emot ui-widget-content"><%=emots%></div>'},{_init:function(){var a=this,b=a.element;C(b.firstChild.childNodes,function(c,d){x(d,"click",function(){O(b,"webim-emot-show");a.trigger("select",this.firstChild.getAttribute("rel"))})})},template:function(){var a=this.emots=webim.ui.emot.emots,b=[];b.push('<ul class="ui-helper-clearfix">');C(a,function(c,
d){var f=d.src,h=d.t?d.t:d.q[0];b.push('<li><img src="');b.push(f);b.push('" title="');b.push(h);b.push('" alt="');b.push(d.q[0]);b.push('" rel="');b.push(d.q[0]);b.push('" /></li>')});b.push("</ul>");return U(this.options.template,{emots:b.join("")})},toggle:function(){ga(this.element,"webim-emot-show")}});L(v.emot,{emots:[{t:"smile",src:"smile",q:[":)"]},{t:"smile_big",src:"smile-big",q:[":d",":-d",":D",":-D"]},{t:"sad",src:"sad",q:[":(",":-("]},{t:"wink",src:"wink",q:[";)",";-)"]},{t:"tongue",
src:"tongue",q:[":p",":-p",":P",":-P"]},{t:"shock",src:"shock",q:["=-O","=-o"]},{t:"kiss",src:"kiss",q:[":-*"]},{t:"glasses_cool",src:"glasses-cool",q:["8-)"]},{t:"embarrassed",src:"embarrassed",q:[":-["]},{t:"crying",src:"crying",q:[":'("]},{t:"thinking",src:"thinking",q:[":-/",":-\\"]},{t:"angel",src:"angel",q:["O:-)","o:-)"]},{t:"shut_mouth",src:"shut-mouth",q:[":-X",":-x"]},{t:"moneymouth",src:"moneymouth",q:[":-$"]},{t:"foot_in_mouth",src:"foot-in-mouth",q:[":-!"]},{t:"shout",src:"shout",q:[">:o",
">:O"]}],init:function(a){var b=webim.ui.emot,c=b._q={};a=L({dir:"webim/static/emot/default",ext:"png"},a);if(a.emots)b.emots=a.emots;var d=a.dir+"/",f=a.ext;C(b.emots,function(h,m){if(m&&m.src)m.src=d+m.src+"."+f;m&&m.q&&C(m.q,function(k,o){c[o]=h})})},parse:function(a){var b=webim.ui.emot._q,c=webim.ui.emot.emots;b&&C(b,function(d,f){var h=c[f],m=h.src,k=h.t?h.t:h.q[0],o=[];o.push('<img src="');o.push(m);o.push('" title="');o.push(k);o.push('" alt="');o.push(h.q[0]);o.push('" />');d=za(d);d=d.replace(RegExp("(\\"+
".$^*\\[]()|+?{}:<>".split("").join("|\\")+")","g"),"\\$1");a=a.replace(RegExp(d,"g"),o.join(""))});return a}});P("upload",{template:'<div class="webim-upload ui-widget-content"><form class="ui-helper-clearfix" id=":form" method="POST" enctype="multipart/form-data" encoding="multipart/form-data"><input id=":input" type="file" name="files" /><input id=":submit" class="ui-state-default ui-corner-all webim-upload-submit" type="submit" value="<%=upload%>" /></form></div>'},{_init:function(){var a=this;
a.$.form.setAttribute("action",X("upload"));r(a.$.form,function(b){a.$.submit.disabled=false;if(b=b&&b[0])if(!b.url||b.error)alert(b.error||"Upload error");else{for(var c="",d=["image/jpeg","image/jpg","image/gif","image/png"],f=0;f<d.length;f++)if(d[f]==b.type){c="!";break}c+="["+(b.name||"").replace(/\[|\]/ig,"")+"]("+b.url+")";if(b.thumbnailUrl)c+="("+b.thumbnailUrl+")";try{a.$.form.reset();a.$.input.value=""}catch(h){}a.toggle();a.trigger("upload",c)}else alert("Upload error")},function(){a.$.submit.disabled=
true})},toggle:function(){ga(this.element,"webim-upload-show")}});da("chat",function(a){a=a||{};var b=this,c=b.im,d=c.buddy,f=c.room,h=c.history,m=c.data.user,k=a.id,o=a.type;if(o=="room"){var z=h.get("grpchat",k);z||h.load("grpchat",k);var s=c.room.get(k)||{id:k,nick:a.nick||k};s.presence="online";a=L({emot:true,clearHistory:false,member:true,block:true,downloadHistory:false},b.options.roomChatOptions,{info:s,user:c.data.user,history:z,type:o},a);var t=new v.chat(null,a);t.bind("sendMessage",function(A,
w){c.sendMessage(w,function(Q){Q&&Q.message&&t.history.notice("error",Q.message)});h.set(w)}).bind("downloadHistory",function(A,w){h.download("grpchat",w.id)}).bind("select",function(A,w){if(!(w.id===m.id&&!d.get(m.id))){w.presence="online";d.presence(w);b.layout.addChat("buddy",w.id,w.nick);b.layout.focusChat("buddy",w.id)}}).bind("block",function(A,w){f.block(w.id)}).bind("unblock",function(A,w){f.unblock(w.id)}).bind("destroy",function(){t.options.info.blocked&&f.leave(k)});setTimeout(function(){t.options.info.blocked?
f.join(k):f.loadMember(k)},500);n(s.members)&&C(s.members,function(A,w){t.addMember(w.id,w.nick,w.presence=="offline"||w.show=="invisible")});f.bind("memberLeaved",function(A,w,Q){w==k&&t.history.notice("highlight",p("user leaved notice",{name:Q.nick}))}).bind("memberJoined",function(A,w,Q){w==k&&t.history.notice("highlight",p("user joined notice",{name:Q.nick}))}).bind("memberOnline",function(A,w,Q){w==k&&t.history.notice("highlight",p("member online notice",{name:Q.nick}))}).bind("memberOffline",
function(A,w,Q){w==k&&t.history.notice("highlight",p("member offline notice",{name:Q.nick}))})}else{(z=h.get("chat",k))||h.load("chat",k);s=c.buddy.get(k)||{id:k,nick:a.nick||k};a=L({emot:true,clearHistory:true},b.options.buddyChatOptions,{info:s,user:c.data.user,history:z,block:false,member:false,msgType:"chat"},a);t=new v.chat(null,a);c.buddy.get(k)||c.buddy.update(k);t.bind("sendMessage",function(A,w){c.sendMessage(w,function(Q){Q&&Q.message&&t.history.notice("error",Q.message)});h.set(w)}).bind("sendStatus",
function(A,w){c.sendStatus(w)}).bind("clearHistory",function(A,w){h.clear("chat",w.id)}).bind("downloadHistory",function(A,w){h.download("chat",w.id)})}return t});P("chat",{tpl_header:'<div><div id=":user" class="webim-user"> \t<a id=":userPic" class="webim-user-pic ui-corner-all ui-state-active" href="#id"><img width="50" height="50" src="" defaultsrc="" onerror="var d=this.getAttribute(\'defaultsrc\');if(d && this.src!=d)this.src=d;" class="ui-corner-all"></a> \t<span id=":userStatus" title="" class="webim-user-status">&nbsp;</span> \t</div></div>',
template:'<div id=":container" class="webim-chat webim-box webim-flex"> \t<div class="webim-chat-notice-wrap1"><div class="webim-chat-notice-wrap"><div id=":notice" class="webim-chat-notice ui-state-highlight"></div></div> </div>\t<div id=":content" class="webim-chat-content webim-flex webim-box-h"> \t<div id=":sidebar" class="webim-chat-sidebar webim-box"></div><div class="webim-flex webim-box"><div id=":main" class="webim-chat-main webim-flex"><div id=":status" class="webim-chat-status webim-gray"></div></div></div> \t</div> \t<div id=":actions" class="webim-chat-actions"> \t<div id=":toolContent" class="webim-chat-tool-content"></div>\t<div id=":tools" class="webim-chat-tools ui-helper-clearfix ui-state-default"></div>\t<table class="webim-chat-t" cellSpacing="0"> \t<tr> \t<td style="vertical-align:top;width:100%;"> \t<div class="webim-chat-input-wrap">\t<textarea id=":input" class="webim-chat-input webim-gray ui-widget-content"><%=input notice%></textarea> \t</div> \t</td> \t</tr> \t</table> \t</div> \t</div>'},
{_init:function(){var a=this,b=a.element,c=a.options,d=c.window,f=a.history=new v.history(null,{user:c.user,info:c.info});K(b,"webim-chat-"+c.type);a.$.main.insertBefore(f.element,a.$.main.firstChild);a.header=H(U(c.tpl_header));L(a.$,F(a.header));a._initEvents();d&&a.setWindow(d);c.simple&&B(a.header);a.update(c.info);f.add(c.history);ba.call(a,"init",[null,a.ui()]);setTimeout(function(){a._adjustContent()},0)},setWindow:function(a,b){this.window=a;a.subHeader(this.header);!b&&a.html(this.element);
a.title(this.options.info.nick);this._bindWindow()},update:function(a){if(a){this.options.info=a;this.history.options.info=a;this._updateInfo(a)}a=this.options.info.presence=="online"&&this.options.info.show!="invisible";if(this.options.user.presence=="online")a?this.notice(""):this.notice(p("buddy offline notice",{name:this.options.info.nick}));else this.notice(p("user offline notice"));ba.call(this,"update",[null,this.ui()])},focus:function(){var a=this.$.input;y.setTimeout(function(){try{a.focus()}catch(b){}},
0)},_noticeTime:null,_noticeTxt:"",notice:function(a,b){var c=this,d=c.$.notice,f=c._noticeTime;f&&clearTimeout(f);if(a)if(b){d.innerHTML=a;M(d);setTimeout(function(){if(c._noticeTxt)d.innerHTML=c._noticeTxt;else B(d,500)},b)}else{c._noticeTxt=a;d.innerHTML=a;M(d)}else{c._noticeTxt=null;B(d)}},_adjustContent:function(){var a=this.$.main;if(a.scrollTop!=a.scrollHeight)a.scrollTop=a.scrollHeight},_fitUI:function(){this._adjustContent()},_bindWindow:function(){var a=this;a.window.bind("displayStateChange",
function(b,c){if(c!="minimize"){y.setTimeout(function(){a.$.input.focus()},0);a._adjustContent()}}).bind("close",function(){a.destroy()})},_inputAutoHeight:function(){var a=this.$.input,b=a[0].scrollTop;if(b>0){var c=a.height();c>32&&c<100&&a.height(c+b)}},sendMessage:function(a){var b=this.options,c=b.info;a={type:b.type=="room"?"grpchat":"chat",to:c.id,from:b.user.id,nick:b.user.nick,to_nick:c.nick,offline:c.presence!="online"?"true":"false",timestamp:(new Date).getTime()-g.timeSkew,body:a};ba.call(this,
"send",[null,this.ui({msg:a})]);this.trigger("sendMessage",[a])},_inputkeypress:function(a){if(a.keyCode==13)if(a.ctrlKey){this.insert("\n",true);return true}else{var b=ya(a),c=b.value;if(R(c).length){this.sendMessage(c);b.value="";G(a)}}else this._typing()},_onFocusInput:function(a){var b=this;ya(a);(y.getSelection?y.getSelection().toString():D.selection?D.selection.createRange().text:"")||y.setTimeout(function(){b.$.input.focus()},0)},_initEvents:function(){var a=this,b=a.$,c=p("input notice"),
d=b.input;a.history.bind("update",function(){a._adjustContent()}).bind("clear",function(){a.notice(p("clear history notice"),3E3)});x(d,"keyup",function(){Y.call(this)});x(d,"click",Y);x(d,"select",Y);x(d,"focus",function(){O(this,"webim-gray");if(this.value==c)this.value=""});x(d,"blur",function(){if(this.value==""){K(this,"webim-gray");this.value=c}});x(d,"keypress",function(f){a._inputkeypress(f)});x(b.main,"click",function(f){a._onFocusInput(f)})},_updateInfo:function(a){var b=this.$;b.userPic.setAttribute("href",
a.url);b.userPic.setAttribute("target",a.target||this.options.target||"");b.userPic.firstChild.setAttribute("defaultsrc",a.default_avatar?a.default_avatar:"");setTimeout(function(){if(a.avatar||a.default_avatar)try{b.userPic.firstChild.setAttribute("src",a.avatar||a.default_avatar)}catch(c){}},100);b.userStatus.innerHTML=Aa(a.status)||"&nbsp";this.window&&this.window.title(a.nick,a.show)},insert:function(a,b){var c=this.$.input;c.focus();if(c.value==p("input notice"))c.value="";if(b){a||(a="");if(c.setSelectionRange){var d=
c.value,f=c.selectionStart,h=c.selectionEnd,m=d.substring(0,f);d=d.substring(h);h=a.length;c.value=m+a+d;c.setSelectionRange(f+h,f+h)}else if(D.selection)if(f=c.caretPos){f.text=a;f.collapse();f.select()}else c.value+=a;else c.value+=a}else c.value=a},_statusText:"",sendStatus:function(a){if(!(!a||a==this._statusText||this.options.info.presence=="offline")){this._statusText=a;this.trigger("sendStatus",[{to:this.options.info.id,show:a}])}},_checkST:false,_typing:function(){var a=this;a.sendStatus("typing");
a._checkST&&clearTimeout(a._checkST);a._checkST=y.setTimeout(function(){a.sendStatus("clear")},6E3)},_setST:null,status:function(a){a=a||"clear";var b=this.$.status,c=this.options.info.nick,d="";d=a=="clear"?"":c+p(a);b.innerHTML=d;this._adjustContent();this._setST&&clearTimeout(this._setST);if(d!="")this._setST=y.setTimeout(function(){b.innerHTML=""},1E4)},destroy:function(){this.trigger("destroy")},ui:function(a){return L({self:this,$:this.$,history:this.history},a)},plugins:{}});v.chat.defaults.emot=
true;ba.add("chat","emot",{init:function(a,b){var c=b.self,d=c.emot=new v.emot;d.bind("select",function(h,m){c.focus();c.insert(m,true)});var f=H(U('<a href="#chat-emot" title="<%=emot%>"><em class="webim-icon webim-icon-emot"></em></a>'));x(f,"click",function(h){c.upload&&O(c.upload.element,"webim-upload-show");G(h);d.toggle()});b.$.toolContent.appendChild(d.element);b.$.tools.appendChild(f)},send:function(){}});v.chat.defaults.upload=false;ba.add("chat","upload",{init:function(a,b){var c=b.self,
d=c.upload=new v.upload;d.bind("upload",function(h,m){c.sendMessage(m)});var f=H(U('<a href="#chat-upload" title="<%=upload%>"><em class="webim-icon webim-icon-upload"></em></a>'));x(f,"click",function(h){c.emot&&O(c.emot.element,"webim-emot-show");G(h);d.toggle()});b.$.toolContent.appendChild(d.element);b.$.tools.appendChild(f)},send:function(){}});v.chat.defaults.clearHistory=true;ba.add("chat","clearHistory",{init:function(a,b){var c=b.self,d=H(U('<a href="#chat-clearHistory" title="<%=clear history%>"><em class="webim-icon webim-icon-clear"></em></a>'));
x(d,"click",function(f){G(f);c.trigger("clearHistory",[c.options.info])});b.$.tools.appendChild(d)}});v.chat.defaults.block=true;ba.add("chat","block",{init:function(a,b){var c=b.self,d=c.options.info.blocked,f=c.options.info.nick,h=H('<a href="#chat-block" style="display:'+(d?"none":"")+'" title="'+p("block group",{name:f})+'"><em class="webim-icon webim-icon-unblock"></em></a>'),m=H('<a href="#chat-block" style="display:'+(d?"":"none")+'" title="'+p("unblock group",{name:f})+'"><em class="webim-icon webim-icon-block"></em></a>');
x(h,"click",function(k){G(k);B(h);M(m);c.trigger("block",[c.options.info])});x(m,"click",function(k){G(k);B(m);M(h);c.trigger("unblock",[c.options.info])});b.$.tools.appendChild(h);b.$.tools.appendChild(m)}});v.chat.defaults.member=true;L(v.chat.prototype,{updateRoom:function(a){for(var b=this,c=b.$.member;c.hasChildNodes();)c.removeChild(c.lastChild);b.memberLi={};b.$.memberCount.innerHTML="0";C(a.members,function(d,f){b.addMember(f.id,f.nick,f.presence=="offline"||f.show=="invisible")})},addMember:function(a,
b,c){var d=this,f=d.memberLi;if(!f[a]){c=H("<li"+(c?' class="ui-state-disabled"':"")+'><a  href="'+a+'">'+b+"</a></li>");x(c.firstChild,"click",function(h){G(h);d.trigger("select",[{id:a,nick:b}])});f[a]=c;d.$.member.appendChild(c);d.$.memberCount.innerHTML=parseInt(d.$.memberCount.innerHTML)+1}},removeMember:function(a){var b=this.memberLi[a];if(b){this.$.member.removeChild(b);delete this.memberLi[a];this.$.memberCount.innerHTML=parseInt(this.$.memberCount.innerHTML)-1}}});ba.add("chat","member",
{init:function(a,b){var c=b.$;b.self.memberLi={};var d=H(U('<div class="webim-box webim-flex  webim-member ui-widget-content ui-corner-left"><iframe id=":bgiframe" class="webim-bgiframe" frameborder="0" tabindex="-1" src="about:blank;" ></iframe><h4><%=room member%>:<span id=":memberCount">0</span></h4><ul id=":ul" class="webim-flex"></ul></div>')),f=F(d);c.member=f.ul;c.memberCount=f.memberCount;c.sidebar.appendChild(d)}});v.chat.defaults.downloadHistory=true;ba.add("chat","downloadHistory",{init:function(a,
b){var c=b.self,d=H(U('<a style="float: right;" href="#chat-downloadHistory" title="<%=download history%>"><em class="webim-icon webim-icon-download"></em></a>'));x(d,"click",function(f){G(f);c.trigger("downloadHistory",[c.options.info])});b.$.tools.appendChild(d)}});da("setting",function(a){var b=this.im.setting,c=this.layout,d=this.setting=new v.setting(null,a);c.addWidget(d,{title:p("setting"),icon:"setting",sticky:false,onlyIcon:true,isMinimize:true});b.bind("update",function(f,h,m){typeof m!=
"object"&&d.check_tag(h,m)});d.bind("change",function(f,h,m){b.set(h,m)})});P("setting",{template:'<div id="webim-setting" class="webim-setting">\t\t\t<ul id=":ul"><%=tags%></ul>\t\t   </div>',tpl_check:'<li id=":<%=name%>"><input type="checkbox" <%=checked%> id="webim-setting-<%=name%>" name="<%=name%>"/><label for="webim-setting-<%=name%>"><%=label%></label></li>'},{_init:function(){var a=this.options.copyright;if(a){a=a===true?'<p style="margin: 5px 10px;"><a class="webim-gray" href="http://nextalk.im/" target="_blank">Powered by <strong>NexTalk</strong><em>&nbsp5.5</em></a></p>':
a;this.element.appendChild(H(a))}},template:function(){var a=this,b=[],c=a.options.data;c&&C(c,function(d,f){f&&typeof f!="boolean"||b.push(a._check_tpl(d,f))});return U(a.options.template,{tags:b.join("")})},_initEvents:function(){var a=this,b=a.options.data,c=a.$;b&&C(b,function(d){c[d]&&a._check_event(c[d])})},_check_tpl:function(a,b){return U(this.options.tpl_check,{label:p(a),name:a,checked:b?'checked="checked"':""})},_check_event:function(a){var b=this;x(a.firstChild,"click",function(){b._change(this.name,
this.checked)})},check_tag:function(a,b){var c=this;if(E(a))C(a,function(h,m){c.check_tag(h,m)});else{var d=c.$,f=d[a];if(!(b&&typeof b!="boolean"))if(f)f.firstChild.checked=b;else{f=d[a]=H(c._check_tpl(a,b));c._check_event(f);d.ul.appendChild(f)}}},_change:function(a,b){this.trigger("change",[a,b])},destroy:function(){}});da("user",function(a){a=a||{};var b=this.im,c=new v.user;!a.show&&B(c.element);a.container&&a.container.appendChild(c.element);c.bind("online",function(d,f){b.online(f)}).bind("offline",
function(){b.offline()}).bind("presence",function(d,f){b.sendPresence(f)});c.update(b.data.user);b.bind("online",function(){M(c.element);c.update(b.data.user)}).bind("offline",function(){c.show("unavailable")});return c});P("user",{template:'<div>  \t\t<div id=":user" class="webim-user"> \t\t\t<a id=":userPic" class="webim-user-pic ui-corner-all ui-state-active" href="#id"><img width="50" height="50" defaultsrc="" onerror="var d=this.getAttribute(\'defaultsrc\');if(d && this.src!=d)this.src=d;" class="ui-corner-all"></a> \t\t\t\t<div class="webim-user-show"><h4><a  id=":userShowTrigger" href="#show"><strong id=":userNick"></strong><span id=":userShow"><em class="webim-icon webim-icon-unavailable"><%=unavailable%></em><%=unavailable%></span><em class="ui-icon ui-icon-triangle-1-s"><%=show_status_list%></em></a></h4>\t\t\t\t\t<p id=":userShowList" class="ui-state-active ui-corner-all" style="display: none;">\t\t\t\t\t\t<a href="#available" class="webim-user-show-available"><em class="webim-icon webim-icon-available"><%=available%></em><%=available%></a>\t\t\t\t\t\t<a href="#dnd" class="webim-user-show-dnd"><em class="webim-icon webim-icon-dnd"><%=dnd%></em><%=dnd%></a>\t\t\t\t\t\t<a href="#away" class="webim-user-show-away"><em class="webim-icon webim-icon-away"><%=away%></em><%=away%></a>\t\t\t\t\t\t<a href="#invisible" class="webim-user-show-invisible"><em class="webim-icon webim-icon-invisible"><%=invisible%></em><%=invisible%></a>\t\t\t\t\t\t<a href="#unavailable" class="webim-user-show-unavailable"><em class="webim-icon webim-icon-unavailable"><%=unavailable%></em><%=unavailable%></a>\t\t\t\t\t</p>\t\t\t\t</div> \t\t\t\t\t<span id=":userStatus" title="" class="webim-user-status"></span> \t\t\t\t\t\t</div> \t\t\t\t\t\t\t</div>'},
{_init:function(){},_initEvents:function(){var a=this,b=a.$,c=b.userShowList;x(b.userShowTrigger,"click",function(d){c.style.display=="block"?B(c):M(c);G(d)});C(pa(c.firstChild),function(d,f){x(f,"click",function(h){a._set(this.href.split("#")[1]);B(c);G(h)})})},update:function(a){var b=a.show||"unavailable",c=this.$;this.options.info=a;c.userStatus.innerHTML=Aa(a.status)||"&nbsp;";c.userNick.innerHTML=a.nick||"";c.userPic.setAttribute("href",a.url);c.userPic.firstChild.setAttribute("defaultsrc",
a.default_avatar?a.default_avatar:"");setTimeout(function(){if(a.avatar||a.default_avatar)c.userPic.firstChild.setAttribute("src",a.avatar||a.default_avatar)},100);this.show(b)},show:function(a){var b=p(a);this.$.userShow.innerHTML='<em class="webim-icon webim-icon-'+a+'">'+b+"</em>"+b},_set:function(a){var b=this.options.info;this.show(a);if(b){if(b.show!=a)if(a=="unavailable")this.trigger("offline",[]);else b.show=="unavailable"?this.trigger("online",[{show:a}]):this.trigger("presence",[{show:a,
status:b.status}])}else a!="unavailable"&&this.trigger("online",[{show:a}])},destroy:function(){}});da("login",function(a){a=a||{};var b=this.im,c=new v.login(null,a);a.container&&a.container.appendChild(c.element);c.bind("login",function(d,f){b.online(f)});b.bind("online",function(){c.hide()}).bind("offline",function(d,f,h){f=="online"&&c.showError(h)});return c});P("login",{questions:null,notice:"",template:'<div id=":login" class="webim-login"> \t\t\t<div class="webim-login-logo" id=":logo"></div>\t\t\t<div class="webim-login-notice" id=":notice"></div>\t\t\t<div class="ui-state-error webim-login-error ui-corner-all" style="display: none;" id=":error"></div>\t\t\t<form id=":form">\t\t\t\t<p class="ui-helper-clearfix"><label for=":username"><%=username%></label><input name="username" id=":username" type="text" /></p>\t\t\t\t<p class="ui-helper-clearfix"><label for=":password"><%=password%></label><input name="password" id=":password" type="password" /></p>\t\t\t\t<div id=":more">\t\t\t\t<p class="ui-helper-clearfix"><label for=":question"><%=question%></label><select name="question" id=":question" ></select></p>\t\t\t\t<p class="ui-helper-clearfix"><label for=":answer"><%=answer%></label><input name="answer" id=":answer" type="text" /></p>\t\t\t\t</div>\t\t\t\t<p class="ui-helper-clearfix"><input name="submit" id=":submit" class="ui-state-default ui-corner-all webim-login-submit" value="<%=login%>" type="submit" /></p>\t\t\t</form>\t\t</div>'},
{_init:function(){var a=this.options.questions,b=this.$;a&&a.length?C(a,function(c,d){var f=D.createElement("option");f.value=d[0];f.innerHTML=d[1];b.question.appendChild(f)}):B(b.more);b.notice.innerHTML=this.options.notice},_initEvents:function(){var a=this,b=a.$;qa(b.submit,"ui-state-hover");x(b.form,"submit",function(c){G(c);a.trigger("login",[{username:b.username.value,password:b.password.value,question:b.question.value,answer:b.answer.value}])})},hide:function(){B(this.element)},show:function(){M(this.element)},
hideError:function(){B(this.$.error)},showError:function(a){var b=this.$.error;b.innerHTML=p(a);M(b)},destroy:function(){}});da("buddy",function(a){a=a||{};var b=this,c=b.im,d=c.buddy,f=b.layout,h=new v.buddy(null,L({title:a.title||p("buddy")},a));f.addWidget(h,{className:"webim-buddy-window",title:a.title||p("buddy"),titleVisibleLength:19,sticky:c.setting.get("buddy_sticky"),isMinimize:!c.status.get("b"),icon:"buddy"});h.bind("select",function(s,t){b.layout.addChat("buddy",t.id);b.layout.focusChat("buddy",
t.id)}).bind("remove",function(s,t){y.confirm(p("Remove Buddy",{name:t.nick}))&&d.remove(t.id)});var m;if(!a.disable_user){m=b.addApp("user",a.userOptions);if(a.is_login){h.window.subHeader(m.element);M(m.element);m=null}}!a.is_login&&!a.disable_login&&b.addApp("login",L({container:h.$.content},a.loginOptions));c.setting.bind("update",function(s,t){if(s=="buddy_sticky")h.window.option.sticky=t});h.window&&h.window.bind("displayStateChange",function(s,t){if(t!="minimize"){d.options.active=true;c.status.set("b",
1);d.complete()}else{c.status.set("b",0);d.options.active=false}});var k=function(s){return E(s)?s.id:s},o=function(s){return s.show!="invisible"&&s.presence=="online"},z=function(s){return s.show=="invisible"};d.bind("online",function(s,t){if(a.showUnavailable){h.remove(aa(t,k));h.add(t)}else h.add(ha(t,o))});d.bind("offline",function(s,t){if(a.showUnavailable){h.remove(aa(t,k));h.add(t)}else h.remove(aa(t,k))});d.bind("update",function(s,t){if(a.showUnavailable){h.add(t);h.update(t)}else{h.add(ha(t,
o));h.update(ha(t,o));h.remove(aa(ha(t,z),k))}});d.bind("unsubscribe",function(s,t){var A=aa(t,k);C(A,function(w,Q){b.layout.removeChat("buddy",Q)});h.remove(A)});h.offline();c.bind("beforeOnline",function(){h.online()}).bind("online",function(){m&&h.window.subHeader(m.element);h.titleCount()}).bind("offline",function(){h.offline()});return h});P("buddy",{template:'<div id="webim-buddy" class="webim-buddy webim-flex webim-box">\t\t<div id=":search" class="webim-buddy-search ui-state-default ui-corner-all"><em class="ui-icon ui-icon-search"></em><input id=":searchInput" type="text" value="" /></div>\t\t\t<div class="webim-buddy-content webim-flex" id=":content">\t\t\t\t<div id=":empty" class="webim-buddy-empty"><%=empty buddy%></div>\t\t\t\t\t<ul id=":ul"></ul>\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>',
tpl_group:'<li><h4><em class="ui-icon ui-icon-triangle-1-s"></em><span><%=title%>(<%=count%>)</span></h4><hr class="webim-line ui-state-default" /><ul></ul></li>',tpl_li:'<li title="" class="webim-buddy-<%=show%>"><a href="<%=url%>" rel="<%=id%>" class="ui-helper-clearfix"><div id=":tabCount" class="webim-window-tab-count">0</div><em class="webim-icon ui-icon ui-icon-trash" style="display:none;cursor:pointer;"></em><em class="webim-icon webim-icon-<%=show%>" title="<%=human_show%>"><%=show%></em><img width="25" src="<%=avatar%>" defaultsrc="<%=default_avatar%>" onerror="var d=this.getAttribute(\'defaultsrc\');if(d && this.src!=d)this.src=d;" /><strong><%=nick%></strong><span><%=status%></span></a></li>'},
{_init:function(){var a=this.options;this.groups={};this.li={};this.li_group={};this.on_li={};this.on_li_group={};this.size=0;this.presences={};a.disable_group&&K(this.element,"webim-buddy-hidegroup");a.simple&&K(this.element,"webim-buddy-simple")},_initEvents:function(){var a=this,b=a.$,c=b.search,d=b.searchInput,f=p("search buddy");x(c.firstChild,"click",function(){d.focus()});d.value=f;x(d,"focus",function(){K(c,"ui-state-active");if(this.value==f)this.value=""});x(d,"blur",function(){O(c,"ui-state-active");
if(this.value=="")this.value=f});x(d,"keyup",function(){var h=this.value;if(h==ja||h==""){C(a.groups,function(m,k){M(k.el)});C(a.on_li,function(m,k){M(k)});C(a.li,function(m,k){M(k)})}else{C(a.groups,function(m,k){B(k.el)});C(a.on_li,function(m,k){B(k)});C(a.li,function(m,k){B(k)});C(a.li,function(m,k){if((k.text||k.innerHTML.replace(/<[^>]*>/g,"")).indexOf(h)>=0){var o=a.li_group[m];o&&M(o.el);M(k)}})}})},titleCount:function(){var a=this.size,b=this.window,c=this.$.empty,d=0;C(this.presences,function(f,
h){h.o&&d++});b&&b.title(this.options.title+"["+d+"/"+(a?a:"0")+"]");a?B(c):M(c);a>8?this.scroll(true):this.scroll(false)},groupTitleCount:function(a){var b=0;if(a.name==p("online_group"))a.title.innerHTML=a.name+"["+a.count+"]";else{C(this.presences,function(c,d){d.o&&d.g==a.name&&b++});a.title.innerHTML=a.name+"["+b+"/"+a.count+"]"}},scroll:function(a){ga(this.element,"webim-buddy-scroll",a)},_time:null,_titleBuddyOnline:function(a){var b=this;a||(a="");b._time&&clearTimeout(b._time);b._time=setTimeout(function(){b.titleCount()},
5E3)},_title:function(a){var b=this.window;b&&b.title(this.options.title+"["+p(a)+"]")},notice:function(a,b){switch(a){case "buddyOnline":this._titleBuddyOnline(b);break;default:this._title(a)}},online:function(){var a=this.$;this.notice("connect");B(a.empty)},offline:function(){var a=this.$;this.scroll(false);this.removeAll();this.presences={};B(a.empty);this.notice("offline")},_updateInfo:function(a,b){var c=b.show?b.show:"available";a.className="webim-buddy-"+c;a=a.firstChild;a.setAttribute("href",
b.url);a=a.firstChild;a=a.nextSibling;a=a.nextSibling;a.className="webim-icon webim-icon-"+c;a.setAttribute("title",p(c));a=a.nextSibling;a.setAttribute("defaultsrc",b.default_avatar?b.default_avatar:"");if(b.avatar||b.default_avatar)a.setAttribute("src",b.avatar||b.default_avatar);a=a.nextSibling;a.innerHTML=b.nick;a=a.nextSibling;a.innerHTML=Aa(b.status)||"&nbsp;";return a},showCount:function(a,b){var c=this.li;c[a]&&wa(c[a].firstChild.firstChild,b)},isOnline:function(a){return!(a=="unavailable"||
a=="invisible")},_addOne:function(a,b){var c=this.li,d=this.on_li,f=this.li_group,h=this.on_li_group;a.show=a.show||"available";this.options.online_group&&this.isOnline(a.show)&&this._addOne2Grp(a,d,"online_group",h,false);this._addOne2Grp(a,c,a.group||"friend",f,b)},_addOne2Grp:function(a,b,c,d,f){var h=this,m=a.id,k=h.$.ul;if(!b[m]){if(b===h.li){h.presences[a.id]={o:h.isOnline(a.show),g:p(c)};h.size++}if(!a.default_avatar)a.default_avatar="";a.status=Aa(a.status)||"&nbsp;";a.human_show=p(a.show);
a.avatar=a.avatar||"";b=b[m]=H(U(h.options.tpl_li,a));var o=b.firstChild;x(o.firstChild.nextSibling,"click",function(t){h.trigger("remove",[a]);ka(t);G(t)});x(o,"click",function(t){G(t);h.showCount(m,0);h.trigger("select",[a]);this.blur()});o=h.groups;c=p(c);o=o[c];if(!o){o=H(U(h.options.tpl_group));B(o);if(c==p("stranger"))f=true;if(c==p("online_group"))k.insertBefore(o,k.firstChild);else if(f){k.appendChild(o);h._lastChild=o}else h._lastChild?k.insertBefore(o,k.lastChild):k.appendChild(o);var z=
o.lastChild;f=o.firstChild;var s=f.firstChild;k=h.options.collapse;o={name:c,el:o,count:0,online_count:0,title:o.firstChild.lastChild,li:z};h.groups[c]=o;if(k===ja)B(s);else{if(k){fa(s,"ui-icon-triangle-1-s","ui-icon-triangle-1-e");B(z)}x(f,"click",function(){if(la(s,"ui-icon-triangle-1-s")){fa(s,"ui-icon-triangle-1-s","ui-icon-triangle-1-e");B(z)}else{fa(s,"ui-icon-triangle-1-e","ui-icon-triangle-1-s");M(z)}})}}o.count==0&&M(o.el);d[m]=o;h.isOnline(a.show)?o.li.insertBefore(b,o.li.firstChild):o.li.appendChild(b);
o.count++;h.groupTitleCount(o)}},_updateOne:function(a){var b=this.li,c=this.on_li,d=a.id;b[d]&&this._updateInfo(b[d],a);c[d]&&this._updateInfo(c[d],a);b=a.show||"available";c=p(a.group||"friend");this.presences[a.id]={o:this.isOnline(b),g:c};(a=this.groups[c])&&this.groupTitleCount(a)},update:function(a){a=S(a);for(var b=0;b<a.length;b++)this._updateOne(a[b]);this.titleCount()},add:function(a,b){a=S(a);for(var c=0;c<a.length;c++)this._addOne(a[c],b);this.titleCount()},removeAll:function(){var a=
[],b=this.li;for(var c in b)a.push(c);this.remove(a)},remove:function(a){var b;a=N(a);for(var c=0;c<a.length;c++){b=a[c];this._removeOne(b,this.on_li,this.on_li_group);this._removeOne(b,this.li,this.li_group)}this.titleCount()},_removeOne:function(a,b,c){var d=b[a];if(d){if(b==this.li){this.size--;delete this.presences[a]}if(group=c[a]){group.count--;group.count==0&&B(group.el);this.groupTitleCount(group)}ra(d);delete b[a]}},select:function(a){(a=this.li[a])&&a.firstChild.click();return a},active:function(a){if(this.options.highlightable){this._actived&&
O(this._actived.firstChild,"ui-state-default ui-state-highlight");if(a){if(a=this.li[a]){K(a.firstChild,"ui-state-default ui-state-highlight");this._actived=a}}else this._actived=null}},destroy:function(){}});da("room",function(a){function b(m){var k=m.nick;m=m.all_count===0?L({},m,{group:"group",nick:k}):L({},m,{group:"group",nick:k+"["+(parseInt(m.count)+"/"+parseInt(m.all_count||m.count))+"]"});f.updateChat(m);m.blocked&&(m.nick=k+"["+p("blocked")+"]");h.li[m.id]?h.update(m):h.add(m)}var c=this.im,
d=c.room,f=this.layout,h=this.room=(new webim.ui.room(null,L(a,{buddy:c.buddy,user:c.data.user}))).bind("select",function(m,k){f.addChat("room",k.id);f.focusChat("room",k.id)}).bind("discussion",function(m,k,o){k.id=k.id||ua();d.invite(k.id,k.nick,o,function(){f.addChat("room",k.id);f.focusChat("room",k.id)})}).bind("exit",function(m,k){var o=d.get(k);if(o&&y.confirm(p("Exit Room",{name:o.nick}))){d.leave(k);f.removeChat("room",k)}});c.bind("event",function(m,k){for(var o=0;o<k.length;o++){var z=
k[o].event;z&&z[0]=="invite"&&d.join(z[1],z[2],function(){})}});f.addWidget(h,{title:p("room"),icon:"room",sticky:c.setting.get("buddy_sticky"),onlyIcon:true,isMinimize:true});c.setting.bind("update",function(m,k,o){if(k=="buddy_sticky")h.window.options.sticky=o});d.bind("updated",function(m,k){b(k)}).bind("leaved",function(m,k){h.remove([k])}).bind("blocked",function(m,k){var o=d.get(k);b(o)}).bind("unblocked",function(m,k){var o=d.get(k);b(o)});B(h.$.actions);c.bind("beforeOnline",function(){}).bind("online",
function(){M(h.$.actions)}).bind("offline",function(){B(h.$.actions);h.removeAll()});return h});P("room",{template:'<div id="webim-room" class="webim-room webim-flex webim-box">\t<div id=":list">\t<div id=":search" class="webim-room-search ui-state-default ui-corner-all"><em class="ui-icon ui-icon-search"></em><input id=":searchInput" type="text" value="" /></div>\t<div class="webim-room-content webim-flex">\t<div id=":empty" class="webim-room-empty"><%=empty room%></div>\t<ul id=":ul"></ul>\t</div>\t</div>\t<div id=":discussion" style="display:none;" class="webim-room-discussion">\t<h4><%=discussion%></h4>\t<div><p><%=discussion name%></p><input id=":name" class="webim-room-discussion-name" type="text" /></div>\t<div><p><%=select discussion buddies%></p><ul class="webim-room-discussion-list ui-widget-content" id=":ul2"></ul></div>\t<div><a id=":confirm" href="#" class="webim-button ui-state-default ui-corner-all"><%=confirm%></a><a id=":cancel" href="#" class="webim-button ui-state-default ui-corner-all"><%=cancel%></a></div>\t</div>\t<div id=":actions" class="webim-room-actions"><a id=":create" href="#" class="webim-button ui-state-default ui-corner-all"><%=create discussion%></a></div>\t</div>',
tpl_li:'<li title=""><input class="webim-button ui-state-default ui-corner-all" type="button" value="<%=exit%>" /><input class="webim-button ui-state-default ui-corner-all" type="button" value="<%=invite%>" /><a href="<%=url%>" rel="<%=id%>" class="ui-helper-clearfix"><div id=":tabCount" class="webim-window-tab-count">0</div><img width="25" src="<%=avatar%>" defaultsrc="<%=default_avatar%>" onerror="var d=this.getAttribute(\'defaultsrc\');if(d && this.src!=d)this.src=d;" /><strong><%=nick%></strong></a></li>'},
{_init:function(){this.size=0;this.li={};this._count=0;M(this.$.empty);this.options.discussion||B(this.$.create)},_initEvents:function(){var a=this,b=a.$,c=b.search,d=b.searchInput,f=p("search room");x(c.firstChild,"click",function(){d.focus()});d.value=f;x(d,"focus",function(){K(c,"ui-state-active");if(this.value==f)this.value=""});x(d,"blur",function(){O(c,"ui-state-active");if(this.value=="")this.value=f});x(d,"keyup",function(){var h=this.value;C(a.li,function(m,k){h&&(k.text||k.innerHTML.replace(/<[^>]*>/g,
"")).indexOf(h)==-1?B(k):M(k)})});x(b.create,"click",function(h){G(h);a.updateDiscussion()});x(b.confirm,"click",function(h){G(h);a.confirmDiscussion()});x(b.cancel,"click",function(h){G(h);a.confirmDiscussion(true)})},scroll:function(a){ga(this.element,"webim-room-scroll",a)},_updateInfo:function(a,b){a=a.firstChild.nextSibling.nextSibling;a.setAttribute("href",b.url);a=a.firstChild.nextSibling;a.setAttribute("defaultsrc",b.default_avatar?b.default_avatar:"");a.setAttribute("src",b.avatar);a=a.nextSibling;
a.innerHTML=b.nick;return a},_addOne:function(a){var b=this,c=b.li,d=a.id,f=b.$.ul;b.size++;if(!c[d]){if(!a.default_avatar)a.default_avatar="";c=c[d]=H(U(b.options.tpl_li,a));var h=c.firstChild,m=c.firstChild.nextSibling;if(a.temporary){x(h,"click",function(k){G(k);b.trigger("exit",[d])});x(m,"click",function(k){G(k);b.updateDiscussion(a)})}else{B(m);B(h)}x(m.nextSibling,"click",function(k){G(k);b.showCount(d,0);b.trigger("select",[a]);this.blur()});f.appendChild(c)}},_updateOne:function(a){var b=
this.li,c=a.id;b[c]&&this._updateInfo(b[c],a)},update:function(a){a=S(a);for(var b=0;b<a.length;b++)this._updateOne(a[b])},add:function(a){B(this.$.empty);a=S(a);for(var b=0;b<a.length;b++)this._addOne(a[b]);this.size>8&&this.scroll(true)},removeAll:function(){var a=[],b=this.li;for(var c in b)a.push(c);this.remove(a)},remove:function(a){var b,c,d=this.li;a=N(a);for(var f=0;f<a.length;f++){b=a[f];if(c=d[b]){ra(c);delete d[b]}}},select:function(a){(a=this.li[a])&&a.firstChild.click();return a},destroy:function(){},
confirmDiscussion:function(a){var b=this.$;B(b.discussion);M(b.list);M(b.actions);if(!a){a=this._discussion||{};a.temporary=true;a.nick=b.name.value||p("discussion");b=b.ul2.getElementsByTagName("input");for(var c=[],d=0;d<b.length;d++){var f=b[d];f.checked&&c.push(f.value)}this.trigger("discussion",[a,c])}},updateDiscussion:function(a){var b=[],c=this.options.buddy.all();this._discussion=a;var d=this.$;d.name.value=a&&a.nick.replace(/\([^\)]*\)/ig,"")||p("discussion name input",{name:this.options.user.nick});
for(a=0;a<c.length;a++){var f=c[a];b.push('<li class="'+(f.show&&(f.show=="unavailable"||f.show=="hidden")?"ui-state-disabled":"")+'"><label for="webim-discussion-'+f.id+'"><input id="webim-discussion-'+f.id+'" type="checkbox" name="buddy" value="'+f.id+'" />'+f.nick+"-"+p(f.group)+"</label></li>")}d.ul2.innerHTML=b.join("");M(d.discussion);B(d.list);B(d.actions)},showCount:function(a,b){var c=this.li;c[a]&&wa(c[a].firstChild.nextSibling.nextSibling.firstChild,b)},active:function(a){if(this.options.highlightable){this._actived&&
O(this._actived.firstChild.nextSibling,"ui-state-default ui-state-highlight");if(a){if(a=this.li[a]){K(a.firstChild.nextSibling,"ui-state-default ui-state-highlight");this._actived=a}}else this._actived=null}}});da("menu",function(a){var b=this.layout;a=this.menu=new v.menu(null,a);b.addWidget(a,{title:p("menu"),icon:"home",sticky:false,onlyIcon:false,isMinimize:true},null,"shortcut")});P("menu",{template:'<div id="webim-menu" class="webim-menu">\t\t<ul id=":ul"><%=list%></ul>\t\t\t<div id=":empty" class="webim-menu-empty"><%=empty menu%></div>\t\t\t\t</div>',
tpl_li:'<li><a href="<%=link%>" target="<%=target%>"><img src="<%=icon%>"/><span><%=title%></span></a></li>'},{_init:function(){var a=this.options;a.data&&a.data.length&&B(this.$.empty)},template:function(){var a=this,b=[],c=a.options.data;c&&C(c,function(d,f){b.push(a._li_tpl(f))});return U(a.options.template,{list:b.join("")})},_li_tpl:function(a){return U(this.options.tpl_li,{title:p(a.title),icon:a.icon,link:a.link,target:a.isExtlink?"_blank":""})},_fitUI:function(){var a=this.element;if(a.clientHeight>
300)a.style.height="300px"},add:function(a){var b=this;if(n(a))C(a,function(d,f){b.add(f)});else{var c=b.$;B(c.empty);c.ul.appendChild(H(b._li_tpl(a)))}},destroy:function(){}});da("chatlink",function(a){var b=this,c=b.im,d=b.chatlink=(new webim.ui.chatlink(null,a)).bind("select",function(m,k){b.layout.addChat("buddy",k);b.layout.focusChat("buddy",k)}),f=function(m){return m.show!="invisible"&&m.presence=="online"},h=function(m){return m.show=="invisible"};c.buddy.bind("online",function(m,k){d.add(ha(k,
f))}).bind("update",function(m,k){d.add(ha(k,f));d.remove(ha(k,h))}).bind("offline",function(m,k){d.remove(k)});c.bind("beforeOnline",function(m,k){k.chatlink_ids=d.idsArray()}).bind("online",function(){d.remove(c.data.user)}).bind("offline",function(){d.removeAll()})});P("chatlink",{link_href:[/space\.php\?uid=(\d+)$/i,/space\-(\d+)\.html$/i,/space\-uid\-(\d+)\.html$/i,/\?mod=space&uid=(\d+)$/,/\?(\d+)$/],space_href:[/space\.php\?uid=(\d+)$/i,/space\-(\d+)\.html$/i,/space\-uid\-(\d+)\.html$/i,/\?mod=space&uid=(\d+)/,
/\?(\d+)$/],space_class:/spacemenu_list|line_list|xl\sxl2\scl/i,space_id:/profile_act/i,link_class:null,off_link_class:null,link_wrap:null,space_wrap:null},{_init:function(){function a($,V){if(!$)return false;if(!V)return false;for(var Z=V.length,ca=0;ca<Z;ca++){var oa=V[ca].exec($);if(oa&&oa[1])return oa[1]}return false}var b=this.list={},c=this.options,d=this.anthors={},f=c.link_href,h=c.space_href,m=c.space_id,k=c.off_link_class,o=c.link_class,z=c.space_class,s=c.space_wrap||D;(c=(c.link_wrap||
D).getElementsByTagName("a"))&&C(c,function($,V){var Z=a(V.href,f),ca=V.innerHTML;if(Z&&pa(V.firstChild).length==0&&ca&&(!V.className||!o||o.test(V.className))&&(!V.className||!k||!k.test(V.className))){d[Z]?d[Z].push(V):d[Z]=[V];b[Z]={id:Z,name:ca}}});if(h=a(y.location.href,h)){b[h]=L(b[h],{id:h});s=s.getElementsByTagName("*");c=s.length;for(var t,A,w,Q=0;Q<c;Q++){t=s[Q];A=t.className;w=t.id;if(z&&z.test(A)||m&&m.test(w)){t=pa(t.firstChild);if(t.length){t=t[t.length-1];d[h]?d[h].push(t):d[h]=[t]}break}}}},
_temp:function(a){var b=this;a=H(U('<a id="<%=id%>" href="#chat" title="<%=title%>" class="webim-chatlink"><%=text%></a>',a));x(a,"click",function(c){b.trigger("select",this.id);ka(c);G(c)});return a},idsArray:function(){var a=[];C(this.list,function(b){a.push(b)});return a},add:function(a){var b=this.list,c=this.anthors,d=a.length,f,h,m,k,o;for(f=0;f<d;f++){h=a[f];if(h.id&&(m=h.uid||h.id)&&(k=b[m])){o=c[m];if(!k.elements&&o){k.elements=[];for(var z=0;z<o.length;z++)if(o[z].tagName.toLowerCase()==
"li"){k.elements[z]=D.createElement("li");k.elements[z].appendChild(this._temp({id:h.id,title:"",text:p("chat with me")}))}else k.elements[z]=this._temp({id:h.id,title:p("chat with",{name:k.name}),text:""})}o&&C(o,function(s,t){t.parentNode.insertBefore(k.elements[s],t.nextSibling)})}}},remove:function(a){var b=this.list,c=a.length,d,f,h,m;for(d=0;d<c;d++){f=a[d];if(f.id&&(h=f.uid||f.id)&&(m=b[h]))m.elements&&C(m.elements,function(k,o){ra(o)})}},removeAll:function(){C(this.list,function(a,b){b.elements&&
C(b.elements,function(c,d){ra(d)})})}});da("chatbtn",function(a){var b=this,c=b.im,d=b.chatbtn=(new webim.ui.chatbtn(null,a)).bind("select",function(m,k){b.im.online();k=k.substr(13);b.layout.addChat("buddy",k);b.layout.focusChat("buddy",k);if(a&&a.autoInsertlink){var o=b.layout.chat("buddy",k);o&&o.insert(y.location.href)}}),f=function(m){return m.show!="invisible"&&m.show!="unavailable"},h=function(m){return m.show=="invisible"};c.models.presence.bind("online",function(m,k){d.on(k)}).bind("update",
function(m,k){d.on(ha(k,f));d.off(ha(k,h))}).bind("offline",function(m,k){d.off(k)});c.bind("beforeOnline",function(m,k){k.chatlink_ids=d.idsArray()}).bind("online",function(){d.off(c.data.user)}).bind("offline",function(){d.offAll()})});P("chatbtn",{wrap:null,re_id:[/chat\/([^\/]+)/i],elementId:null,className:/webim-chatbtn/},{_init:function(){function a(o,z){if(!o)return false;if(!z)return false;for(var s=z.length,t=0;t<s;t++){var A=z[t].exec(o);if(A&&A[1])return A[1]}return false}var b=this,c=
b.list={},d=b.options,f=b.anthors={},h=d.re_id,m=d.elementId,k=d.className;d=d.wrap||D;if(m)d=(d=D.getElementById(m))?[d]:null;else d=d.getElementsByTagName("a");d&&C(d,function(o,z){var s=a(z.href,h),t=z.innerHTML;if(s&&pa(z.firstChild).length==0&&t&&(m||k.test(z.className))){f[s]?f[s].push(z):f[s]=[z];c[s]={id:s,name:t};t=H('<i class="webim-chaticon"><em>');z.appendChild(t);z.icon=t;z.title=p("offline");z.id="webim-chatid-"+s;x(z,"click",function(A){b.trigger("select",this.id);ka(A);G(A)})}})},
idsArray:function(){var a=[];C(this.list,function(b){a.push(b)});return a},on:function(a){var b=this.list,c=this.anthors,d=a.length,f,h,m;for(f=0;f<d;f++){h=a[f];if(h.id&&(m=h.uid||h.id)&&b[m])if(h=c[m])for(var k=0;k<h.length;k++){var o=h[k];o&&o.icon&&K(o.icon,"webim-chaticon-online");o&&(o.title=p("available"))}}},off:function(a){var b=this.list,c=this.anthors,d=a.length,f,h,m;for(f=0;f<d;f++){h=a[f];if(h.id&&(m=h.uid||h.id)&&b[m])if(h=c[m])for(var k=0;k<h.length;k++){var o=h[k];o&&o.icon&&O(o.icon,
"webim-chaticon-online");o&&(o.title=p("unavailable"))}}},offAll:function(){C(this.anthors,function(a,b){b&&C(b,function(c,d){d&&d.icon&&O(d.icon,"webim-chaticon-online");d&&(d.title=p("unavailable"))})})}});W("notification",{url:"webim/notifications"},{_init:function(){},grep:function(a){return a&&a.text},handle:function(a){a=ha(S(a),this.grep);a.length&&this.trigger("data",[a])},load:function(){ia({url:X("notifications"),cache:false,context:this,success:this.handle})}});da("notification",function(a){var b=
this.im,c=this.layout,d=this.notification=new v.notification(null,a),f=b.notification=new webim.notification(null,{jsonp:b.options.jsonp});c.addWidget(d,{title:p("notification"),icon:"notification",sticky:false,onlyIcon:true,isMinimize:true});f.bind("data",function(h,m){d.window.notifyUser("information","+"+m.length);d.add(m)});setTimeout(function(){f.load()},2E3)});P("notification",{template:'<div id="webim-notification" class="webim-notification">\t<ul id=":ul"><%=list%></ul>\t<div id=":empty" class="webim-notification-empty"><%=empty notification%></div>\t</div>',
tpl_li:'<li><a href="<%=link%>" target="<%=target%>"><%=text%></a></li>'},{_init:function(){var a=this.options;a.data&&a.data.length&&B(this.$.empty)},template:function(){var a=this,b=[],c=a.options.data;c&&C(c,function(d,f){b.push(a._li_tpl(f))});return U(a.options.template,{list:b.join("")})},_li_tpl:function(a){return U(this.options.tpl_li,{text:a.text,link:a.link,target:this.options.target||a.target||""})},_fitUI:function(){var a=this.element;if(a.clientHeight>300)a.style.height="300px"},add:function(a){var b=
this;if(n(a))C(a,function(d,f){b.add(f)});else{var c=b.$;B(c.empty);c.ul.appendChild(H(b._li_tpl(a)))}},destroy:function(){}})})(window,document);
